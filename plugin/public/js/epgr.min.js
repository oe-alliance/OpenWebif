function toUnixDate(e){var e=e.split(":"),t=new Date;return t.setHours(e[0]),t.setMinutes(e[1]),t.setSeconds(0),Math.floor(t.getTime()/1e3)}function addZero(e){return e=e<10?"0"+e:e}function isBQ(e){return-1<e.indexOf("FROM BOUQUET")&&0!=e.indexOf("1:134:1")}function isAlter(e){return 0==e.indexOf("1:134:1")}(new function(){var c;return{setup:function(){c=this,$("#er_begin").val("22:30"),$("#er_end").val("6:30"),$("#er_begin").timepicker(),$("#er_end").timepicker(),$("#bouquets").chosen({disable_search_threshold:10,no_results_text:"Oops, nothing found!",width:"100%"}),$("#bouquets").chosen().change(function(){$("#bouquets").val($(this).val()),c.er_bqchchanged=!0}),$("#channels").chosen({disable_search_threshold:10,no_results_text:"Oops, nothing found!",width:"100%"}),$("#channels").chosen().change(function(){$("#channels").val($(this).val()),c.er_bqchchanged=!0}),$(".chosen-container .chosen-drop").addClass("ui-widget-content"),"eggplant"!=theme&&"vader"!=theme||$(".chosen-container .chosen-drop").css("background-image","none"),c.getAllServices(),$("#actions").buttonset(),$("#epgrbutton0").click(function(){c.reloadEPGR()}),$("#epgrbutton0").button({icons:{primary:"ui-icon-arrowrefresh-1-w"}}),$("#epgrbutton1").click(function(){c.saveEPGR()}),$("#epgrbutton1").button({icons:{primary:"ui-icon-disk"}}),$("#epgrbutton2").click(function(){c.DoRefresh()}),$("#statuscont").hide()},getAllServices:function(){var e=EPGRnoiptv?"&noiptv=1":"";$.ajax({url:"/api/getallservices?nolastscanned=1"+e,dataType:"json",success:function(e){JSON.stringify(e);e=e.services;FillAllServices(e,!1,function(e,t){$("#channels").append(e),$("#channels").trigger("chosen:updated"),$("#bouquets").append(t),$("#bouquets").trigger("chosen:updated"),c.reloadEPGR()})}})},reloadEPGR:function(){c.showError(""),$.ajax({type:"GET",url:"/epgrefresh",dataType:"xml",success:function(e){c.readEPGR2(e)},error:function(e,t,n){c.showError(e.responseText)}})},readEPGR2:function(t){var n,r;c.er_hasAutoTimer=!1,$.ajax({type:"GET",url:"/epgrefresh/get",dataType:"xml",success:function(e){$(e).find("e2setting").each(function(){let e=$(this).find("e2settingname").text();var t=$(this).find("e2settingvalue").text();0===e.indexOf("config.plugins.epgrefresh.")?(e=e.substring(26),"True"===t?$("#er_"+e).prop("checked",!0):"False"===t?$("#er_"+e).prop("checked",!1):"begin"===e?n=t:"end"===e?r=t:("interval_seconds"==e?(c.binterval_in_seconds=!0,$("#er_interval")):"interval"==e?(c.binterval_in_seconds=!1,$("#er_interval")):$("#er_"+e)).val(t)):"hasAutoTimer"===e&&"True"===t&&(c.er_hasAutoTimer=!0)}),c.UpdateCHBQ(t,n,r)},error:function(e,t,n){c.showError(e.responseText)}})},UpdateCHBQ:function(e,t,n){t=parseInt(t);let r=new Date(1e3*t);var s=addZero(r.getHours()),a=addZero(r.getMinutes());$("#er_begin").val(s+":"+a),t=parseInt(n),s=addZero((r=new Date(1e3*t)).getHours()),a=addZero(r.getMinutes()),$("#er_end").val(s+":"+a);let o=[],i=[];$(e).find("e2service").each(function(){var e=$(this).find("e2servicereference").text();isBQ(e)?i.push(encodeURIComponent(e)):isAlter(e)?o.push(encodeURIComponent(e)):o.push(e)});n=o.slice(),t=i.slice();$("#channels").val(null),$("#bouquets").val(null),$.each(t,function(e,t){$('#bouquets option[value="'+t+'"]').prop("selected",!0)}),$.each(n,function(e,t){$('#channels option[value="'+t+'"]').prop("selected",!0)}),$("#bouquets").trigger("chosen:updated"),$("#channels").trigger("chosen:updated"),c.er_bqchchanged=!1,(c.binterval_in_seconds?($("#lbls").show(),$("#lblm")):($("#lblm").show(),$("#lbls"))).hide(),c.er_hasAutoTimer?$("#er_hasAT").show():$("#er_hasAT").hide()},saveEPGR:function(){let e="/epgrefresh/set?&enabled=";e=(e=(e=(e=(e=(e=(e=(e=(e=e+($("#er_enabled").is(":checked")?"true":"")+"&enablemessage=")+($("#er_enablemessage").is(":checked")?"true":""))+"&begin="+toUnixDate($("#er_begin").val()))+"&end="+toUnixDate($("#er_end").val()))+"&delay_standby="+$("#er_delay_standby").val()+"&afterevent=")+($("#er_afterevent").is(":checked")?"true":"")+"&force=")+($("#er_force").is(":checked")?"true":"")+"&wakeup=")+($("#er_wakeup").is(":checked")?"true":""))+"&adapter="+$("#er_adapter").val(),c.er_hasAutoTimer&&(e=(e=(e+="&inherit_autotimer=")+($("#er_inherit_autotimer").is(":checked")?"true":""))+"&parse_autotimer="+$("#er_parse_autotimer").val()),c.binterval_in_seconds?e+="&interval_seconds="+$("#er_interval").val():e+="&interval="+$("#er_interval").val(),$.ajax({type:"GET",url:e,dataType:"xml",success:function(e){var t=$(e).find("e2state").first(),e=$(e).find("e2statetext").first();c.showError(e.text(),t.text()),t&&c.SaveCHBQ()},error:function(e,t,n){c.showError(e.responseText)}})},SaveCHBQ:function(){if(!1!==c.er_bqchchanged){let n="";var t=$("#bouquets").chosen().val(),r=$("#channels").chosen().val();r&&0<r.length&&$.each(r,function(e,t){isAlter(t)?n+="&sref="+t:n+="&sref="+encodeURIComponent(t)}),t&&0<t.length&&$.each(t,function(e,t){n+="&sref="+t});let e="/epgrefresh/add?multi=1";""!=n&&(e+=n,$.ajax({type:"GET",url:e,dataType:"xml",success:function(e){var t=$(e).find("e2state").first(),e=$(e).find("e2statetext").first();c.showError(e.text(),t.text())},error:function(e,t,n){c.showError(e.responseText)}}))}},DoRefresh:function(){$.ajax({type:"GET",url:"/epgrefresh/refresh",dataType:"xml",success:function(e){var t=$(e).find("e2state").first(),e=$(e).find("e2statetext").first();c.showError(e.text(),t.text())},error:function(e,t,n){c.showError(e.responseText)}})},showError:function(e,t){t=void 0!==t?t:"False",$("#statustext").text(""),!0===t||"True"===t||"true"===t?($("#statusbox").removeClass("ui-state-error").addClass("ui-state-highlight"),$("#statusicon").removeClass("ui-icon-alert").addClass("ui-icon-info")):($("#statusbox").removeClass("ui-state-highlight").addClass("ui-state-error"),$("#statusicon").removeClass("ui-icon-info").addClass("ui-icon-alert")),$("#statustext").text(e),""!==e?$("#statuscont").show():$("#statuscont").hide()}}}).setup();