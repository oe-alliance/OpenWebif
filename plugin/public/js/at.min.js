function toUnixDate(t){var t=t.split("."),e=new Date;return e.setFullYear(t[2],t[1]-1,t[0]),e.setHours(0),e.setMinutes(0),e.setSeconds(0),Math.floor(e.getTime()/1e3)}function initValues(){var r=$("#maxduration"),a=$("#counter"),i=$("#left");for(let e=0;e<100;e++){let t=e.toString();e<10&&(t="0"+t),a.append($("<option></option>").val(e).html(t)),i.append($("<option></option>").val(e).html(t))}for(let e=0;e<1e3;e++){let t=e.toString();e<10&&(t="0"+t),r.append($("<option></option>").val(e).html(t))}$("#tafter").val("5"),$("#tbefore").val("5"),$("#maxduration").val("70");var t=new Date,e=$.datepicker.formatDate("dd.mm.yy",t),n=($("#after").val(e),new Date);n.setDate(t.getDate()+7),e=$.datepicker.formatDate("dd.mm.yy",n),$("#before").val(e),$("#from").val("20:15"),$("#to").val("23:15"),$("#aefrom").val("20:15"),$("#aeto").val("23:15"),$("#after").datepicker({closeText:tstr_done,monthNames:[tstr_january,tstr_february,tstr_march,tstr_april,tstr_may,tstr_june,tstr_july,tstr_august,tstr_september,tstr_october,tstr_november,tstr_december],dayNames:[tstr_sunday,tstr_monday,tstr_tuesday,tstr_wednesday,tstr_thursday,tstr_friday,tstr_saturday,tstr_sunday],dayNamesMin:[tstr_su,tstr_mo,tstr_tu,tstr_we,tstr_th,tstr_fr,tstr_sa,tstr_su],dateFormat:"dd.mm.yy",onClose:function(t,e){""!=$("#after").val()&&$(this).datepicker("getDate")<$("#before").datepicker("getDate")?showError(tstr_start_after_end):showError("")}}),$("#before").datepicker({closeText:tstr_done,monthNames:[tstr_january,tstr_february,tstr_march,tstr_april,tstr_may,tstr_june,tstr_july,tstr_august,tstr_september,tstr_october,tstr_november,tstr_december],dayNames:[tstr_sunday,tstr_monday,tstr_tuesday,tstr_wednesday,tstr_thursday,tstr_friday,tstr_saturday,tstr_sunday],dayNamesMin:[tstr_su,tstr_mo,tstr_tu,tstr_we,tstr_th,tstr_fr,tstr_sa,tstr_su],dateFormat:"dd.mm.yy",onClose:function(t,e){""!=$("#before").val()&&$(this).datepicker("getDate")>$("#after").datepicker("getDate")?showError(tstr_start_after_end):showError("")}}),$(".date").each(function(t,e){$('<span style="display: inline-block">').addClass("ui-icon ui-icon-calendar").insertAfter(e).position({of:e,my:"right top",at:"right top+2"})}),$(".time").each(function(t,e){$('<span style="display: inline-block">').addClass("ui-icon ui-icon-clock").insertAfter(e).position({of:e,my:"right top",at:"right top+2"})}),$("#bouquets").chosen({disable_search_threshold:10,no_results_text:"Oops, nothing found!",width:"80%"}),$("#bouquets").chosen().change(function(){$("#bouquets").val($(this).val())}),$("#channels").chosen({disable_search_threshold:10,no_results_text:"Oops, nothing found!",width:"80%"}),$("#channels").chosen().change(function(){$("#channels").val($(this).val())}),$("#tags").chosen({disable_search_threshold:10,no_results_text:"Oops, nothing found!",width:"80%"}),$("#tags").chosen().change(function(){$("#tags").val($(this).val())}),$(".chosen-container .chosen-drop").addClass("ui-widget-content"),"eggplant"!=theme&&"vader"!=theme||$(".chosen-container .chosen-drop").css("background-image","none")}function AddFilter(t,e,r){var a=$("#filterlist tr").length,i=$("#dummyfilter").clone(!0);i.show(),i.attr({id:"f"+a.toString(),name:"f"+a.toString()}),""!=t&&i.find(".FT").val(t),""!=e&&("dayofweek"==e?(i.find(".FM").val(e),i.find(".FI").hide(),i.find(".FS")):(i.find(".FM").val(e),i.find(".FS").hide(),i.find(".FI"))).show().val(r),i.appendTo("#filterlist")}function timeFrameAfterCheck(){var t,e,r;!0===$("#timeFrameAfter").is(":checked")?(t=$("#after").datepicker("getDate"),e=new Date(t),(r=new Date).setDate(e.getDate()+7),t=$.datepicker.formatDate("dd.mm.yy",r),$("#before").val(t),$("#beforeE").show()):(e=new Date(2038,0,1),r=$.datepicker.formatDate("dd.mm.yy",e),$("#before").val(r),$("#beforeE").hide())}function checkValues(){!0===$("#timeSpan").is(":checked")?$("#timeSpanE").show():$("#timeSpanE").hide(),!0===$("#timeSpanAE").is(":checked")?$("#timeSpanAEE").show():$("#timeSpanAEE").hide(),!0===$("#timeFrame").is(":checked")?$("#timeFrameE").show():$("#timeFrameE").hide(),!0===$("#timerOffset").is(":checked")?$("#timerOffsetE").show():$("#timerOffsetE").hide(),!0===$("#maxDuration").is(":checked")?$("#maxDurationE").show():$("#maxDurationE").hide(),!0===$("#Location").is(":checked")?$("#LocationE").show():$("#LocationE").hide(),!0===$("#Bouquets").is(":checked")?$("#BouquetsE").show():$("#BouquetsE").hide(),!0===$("#Channels").is(":checked")?$("#ChannelsE").show():$("#ChannelsE").hide(),!0===$("#Filter").is(":checked")?$("#FilterE").show():$("#FilterE").hide(),""!=$("#afterevent").val()?$("#AftereventE").show():$("#AftereventE").hide(),"0"!=$("#counter").val()?$("#CounterE").show():$("#CounterE").hide(),!0===$("#vps").is(":checked")?$("#vpsE").show():$("#vpsE").hide()}var atxml,ATnoiptv=!1;function InitPage(t){ATnoiptv=t,$("#timeSpan").click(function(){checkValues()}),$("#timeSpanAE").click(function(){checkValues()}),$("#timeFrame").click(function(){checkValues()}),$("#timeFrameAfter").click(function(){timeFrameAfterCheck()}),$("#timerOffset").click(function(){checkValues()}),$("#maxDuration").click(function(){checkValues()}),$("#Location").click(function(){checkValues()}),$("#Bouquets").click(function(){checkValues()}),$("#Channels").click(function(){checkValues()}),$("#Filter").click(function(){checkValues()}),$("#AddFilter").click(function(){AddFilter("","","")}),$("#afterevent").change(function(){checkValues()}),$("#counter").change(function(){checkValues()}),$("#vps").change(function(){checkValues()}),initValues(),checkValues(),getData(),$("#actions").buttonset(),$("#atbutton0").click(function(){addAT()}),$("#atbutton0").button({icons:{primary:"ui-icon-plus"}}),$("#atbutton1").click(function(){delAT()}),$("#atbutton1").button({icons:{primary:"ui-icon-minus"}}),$("#atbutton2").click(function(){reloadAT()}),$("#atbutton2").button({icons:{primary:"ui-icon-arrowrefresh-1-w"}}),$("#atbutton3").click(function(){saveAT()}),$("#atbutton3").button({icons:{primary:"ui-icon-disk"}}),$("#atbutton4").click(function(){parseAT()}),$("#atbutton5").click(function(){test_simulateAT(!0)}),$("#atbutton6").click(function(){test_simulateAT(!1)}),$("#atbutton7").click(function(){listTimers()}),$("#atbutton8").click(function(){getAutoTimerSettings()}),$("#atbutton9").click(function(){exportAT()}),$("#atbutton10").click(function(){importAT()}),$("#statuscont").hide(),$("#simdlg").dialog({modal:!0,overlay:{backgroundColor:"#000",opacity:.5},autoOpen:!1,title:tstr_timerpreview,width:600,height:400}),$("#timerdlg").dialog({modal:!0,overlay:{backgroundColor:"#000",opacity:.5},autoOpen:!1,title:tstr_timerlist,width:600,height:400});var t={Save:function(){setAutoTimerSettings(),$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}},e=$("#atbutton8").data("title");$("#atsettingdlg").dialog({modal:!0,overlay:{backgroundColor:"#000",opacity:.5},autoOpen:!1,title:e,width:600,height:400,buttons:t}),$(".FM").change(function(){var t=$(this).parent().parent();"dayofweek"==$(this).val()?(t.find(".FS").show(),t.find(".FI").hide()):(t.find(".FS").hide(),t.find(".FI").show())}),$("#rfile").change(function(){prepareRestore($(this))})}var CurrentAT=null;function isBQ(t){return-1<t.indexOf("FROM BOUQUET")&&0!=t.indexOf("1:134:1")}function Parse(){$("#atlist").empty();let t=[];var e;"false"==$(atxml).find("e2state").first().text()&&showError($(atxml).find("e2statetext").first().text()),$(atxml).find("timer").each(function(){t.push($(this))}),t.sort(function(t,e){t=t.attr("name"),e=e.attr("name");return t==e?0:e<t?1:-1}),$(t).each(function(){$("#atlist").append($("<li></li>").html($(this).attr("name")).data("id",$(this).attr("id")))}),at2add?(addAT(at2add),at2add=null):((e=$("#atlist").find("li").first())&&(FillAT(e.data("id")),e.addClass("ui-selected"),e.addClass(getActiveCls())),setHover("#atlist li")),0<t.length?($("#atbutton5").show(),$("#atbutton6").show()):($("#atbutton5").hide(),$("#atbutton6").hide())}function getTags(){$.getJSON("/api/gettags",function(t){t=t.tags;let r="";$.each(t,function(t,e){r+="<option value='"+encodeURIComponent(e)+"'>"+e+"</option>"}),$("#tags").append(r),$("#tags").trigger("chosen:updated")})}function ATGetAllServices(e,r){if(void 0!==e){let t=(r=void 0===r?!1:r)?"&type=radio":"";ATnoiptv&&(t+="&noiptv=1"),$.ajax({url:"/api/getallservices?nolastscanned=1"+t,dataType:"json",success:function(t){JSON.stringify(t);t=t.services;FillAllServices(t,!0,e)}})}}function getAllServices(){ATGetAllServices(function(t,e){$("#channels").append(t),$("#channels").trigger("chosen:updated"),$("#bouquets").append(e),$("#bouquets").trigger("chosen:updated"),reloadAT()})}function getData(){getTags(),getAllServices()}function FillAT(t){$(atxml).find("defaults");$(atxml).find("timer").each(function(){$(this).attr("id")==t&&(CurrentAT=new AutoTimerObj($(this))).UpdateUI()}),checkValues()}function AutoTimerObj(t){this.isNew=!1,this.MustSave=!1,this.id=t.attr("id"),this.enabled="yes"==t.attr("enabled"),this.name=t.attr("name"),this.name||(this.name=""),this.match=t.attr("match"),this.match||(this.match=""),this.searchType="partial",t.attr("searchType")&&(this.searchType=t.attr("searchType")),this.searchCase="insensitive",t.attr("searchCase")&&(this.searchCase=t.attr("searchCase")),this.justplay="0",t.attr("justplay")&&(this.justplay=t.attr("justplay")),t.attr("always_zap")&&"1"==t.attr("always_zap")&&(this.justplay="2"),this.overrideAlternatives="1"==t.attr("overrideAlternatives"),this.timeSpan=!1,t.attr("from")&&t.attr("to")&&(this.from=t.attr("from"),this.to=t.attr("to"),this.timeSpan=!0),this.maxduration=null,t.attr("maxduration")&&(this.maxduration=t.attr("maxduration")),t.attr("after")&&t.attr("before")?(a=parseInt(t.attr("after")),e=new Date(1e3*a),r=$.datepicker.formatDate("dd.mm.yy",e),this.after=r,a=parseInt(t.attr("before")),e=new Date(1e3*a),r=$.datepicker.formatDate("dd.mm.yy",e),this.before=r,this.timeFrame=!0):(this.before=null,this.after=null,this.timeFrame=!1),this.avoidDuplicateDescription="0",t.attr("avoidDuplicateDescription")&&(this.avoidDuplicateDescription=t.attr("avoidDuplicateDescription")),this.location=null,t.attr("location")&&(this.location=t.attr("location")),this.timerOffset=!1,t.attr("offset")&&(e=(a=t.attr("offset").split(","))[0],this.timerOffsetAfter=void 0===(r=a[1])?e:r,this.timerOffsetBefore=e,this.timerOffset=!0);var e,r,a=t.find("afterevent");this.afterevent=null,a.text()&&(this.afterevent=a.text(),a.attr("from")&&a.attr("to")?(this.aftereventfrom=a.attr("from"),this.aftereventto=a.attr("to")):(this.aftereventfrom=null,this.aftereventto=null));let i=[],n=[];t.find("e2service").each(function(){var t=$(this).find("e2servicereference").text();isBQ(t)?n.push(encodeURIComponent(t)):i.push(t)}),this.Channels=i.slice(),this.Bouquets=n.slice(),n=[],t.find("e2tags").each(function(){var t=$(this).text();_b.push(encodeURIComponent(t))}),this.Tags=n.slice(),n=[],t.find("include").each(function(){n.push({t:"include",w:$(this).attr("where"),v:$(this).text()})}),t.find("exclude").each(function(){n.push({t:"exclude",w:$(this).attr("where"),v:$(this).text()})}),this.Filters=n.slice(),this.counter=t.attr("counter"),this.counter||(this.counter="0"),this.left=t.attr("left"),this.left||(this.left="0"),this.counterFormat=t.attr("counterFormat"),this.counterFormat||(this.counterFormat=""),this.vps=!1,this.vpso=!1,"yes"===t.attr("vps_enabled")&&(this.vps=!0,"yes"===t.attr("vps_overwrite"))&&(this.vpso=!0),this.series_labeling=!1,"yes"===t.attr("series_labeling")&&(this.series_labeling=!0)}function addAT(a){if(CurrentAT&&CurrentAT.isNew)showError("please save the current autotimer first");else{let e=1;$(atxml).find("timer").each(function(){var t=parseInt($(this).attr("id"));t>=e&&(e=t+1)});var i=tstr_timernewname;let t=e.toString(),r='<timers><timer name="'+i+'" match="'+i+'" enabled="yes" id="'+t+'" justplay="0" overrideAlternatives="1"></timer></timers>';void 0!==a&&(r='<timers><timer name="'+a.name+'" match="'+a.name+'" enabled="yes" id="'+t+'" from="'+a.from+'" to="'+a.to+'"',r=(r+=' searchType="exact" searchCase="sensitive" justplay="0" overrideAlternatives="1" ')+"><e2service><e2servicereference>"+a.sref+"</e2servicereference><e2servicename>"+a.sname+"</e2servicename></e2service></timer></timers>");i=$.parseXML(r);$(i).find("timer").each(function(){$("#atlist").append($("<li></li>").html($(this).attr("name")).data("id",$(this).attr("id"))),(CurrentAT=new AutoTimerObj($(this))).isNew=!0,CurrentAT.MustSave=!0,CurrentAT.UpdateUI()}),$("#atlist").find("li").each(function(){$(this).data("id")==t?$(this).addClass("ui-selected"):$(this).removeClass("ui-selected")})}}function delAT(){CurrentAT&&!CurrentAT.isNew&&!1!==confirm(tstr_del_autotimer+" ("+CurrentAT.name+") ?")&&$.ajax({type:"GET",url:"/autotimer/remove?id="+CurrentAT.id,dataType:"xml",success:function(t){var e=$(t).find("e2state").first();showError($(t).find("e2statetext").first().text(),e),readAT()},error:function(t,e,r){showError(t.responseText)}})}function readAT(){CurrentAT=null,$.ajax({type:"GET",url:"/autotimer",dataType:"xml",success:function(t){atxml=t,Parse()},error:function(t,e,r){showError(t.responseText)}})}function saveAT(){if(CurrentAT){let a="/autotimer/edit?",s=(CurrentAT.enabled=$("#enabled").is(":checked"),CurrentAT.name=$("#name").val(),CurrentAT.match=$("#match").val(),CurrentAT.searchType=$("#searchType").val(),CurrentAT.searchCase=$("#searchCase").val(),CurrentAT.justplay=$("#justplay").val(),CurrentAT.overrideAlternatives=$("#overrideAlternatives").is(":checked"),CurrentAT.timeSpan=$("#timeSpan").is(":checked"),CurrentAT.avoidDuplicateDescription=$("#avoidDuplicateDescription").val(),CurrentAT.timeSpan=$("#timeSpan").is(":checked"),CurrentAT.from=$("#from").val(),CurrentAT.to=$("#to").val(),CurrentAT.timerOffset=$("#timerOffset").is(":checked"),CurrentAT.before=$("#before").val(),CurrentAT.after=$("#after").val(),$("#maxDuration").is(":checked")?CurrentAT.maxduration=$("#maxduration").val():CurrentAT.maxduration=null,$("#Location").is(":checked")?CurrentAT.location=$("#location").val():CurrentAT.location=null,CurrentAT.timeFrame=$("#timeFrame").is(":checked"),CurrentAT.timerOffsetBefore=$("#tbefore").val(),CurrentAT.timerOffsetAfter=$("#tafter").val(),CurrentAT.afterevent=$("#afterevent").val(),CurrentAT.aftereventfrom=$("#aefrom").val(),CurrentAT.aftereventto=$("#aeto").val(),CurrentAT.Bouquets=$("#bouquets").chosen().val(),CurrentAT.Channels=$("#channels").chosen().val(),[]);if($.each($("#filterlist tr"),function(t,e){var r,a,i,n,e=$(e);"dummyfilter"!==e.prop("id")&&(r=e.find(".FT"),a=e.find(".FM"),i=e.find(".FI"),n=e.find(".FS"),!1===e.find(".FR").is(":checked")?"dayofweek"===a.val()?s.push({t:r.val(),w:a.val(),v:n.val()}):s.push({t:r.val(),w:a.val(),v:i.val()}):s.push({t:r.val(),w:a.val(),v:""}))}),CurrentAT.Filters=s.slice(),CurrentAT.Tags=$("#tags").chosen().val(),CurrentAT.counter=$("#counter").val(),CurrentAT.left=$("#left").val(),CurrentAT.counterFormat=$("#counterFormat").val(),CurrentAT.vps=$("#vps").is(":checked"),CurrentAT.vpso=!$("#vpssm").is(":checked"),CurrentAT.series_labeling=$("#series_labeling").is(":checked"),a=(a=(a+="match="+encodeURIComponent(CurrentAT.match))+("&name="+encodeURIComponent(CurrentAT.name))+"&enabled=")+(CurrentAT.enabled?"1":"0"),"2"==CurrentAT.justplay?a+="&justplay=0&always_zap=1":a+="&justplay="+CurrentAT.justplay,a=(a=(a=(a=(a+="&setEndtime=")+(CurrentAT.setEndtime?"1":"0"))+("&searchCase="+CurrentAT.searchCase)+"&overrideAlternatives=")+(CurrentAT.overrideAlternatives?"1":"0"))+("&avoidDuplicateDescription="+CurrentAT.avoidDuplicateDescription),CurrentAT.location&&(a+="&location="+encodeURIComponent(CurrentAT.location)),a=a+("&searchType="+CurrentAT.searchType)+"&maxduration=",CurrentAT.maxduration&&-1<CurrentAT.maxduration&&(a+=CurrentAT.maxduration),"0"!=CurrentAT.counter?a=(a+="&counter="+CurrentAT.counter)+"&counterFormat="+CurrentAT.counterFormat:a+="&counter=0",CurrentAT.timerOffset&&-1<CurrentAT.timerOffsetAfter&&-1<CurrentAT.timerOffsetBefore?a+="&offset="+CurrentAT.timerOffsetBefore+","+CurrentAT.timerOffsetAfter:a+="&offset=",CurrentAT.timeSpan?a+="&timespanFrom="+CurrentAT.from+"&timespanTo="+CurrentAT.to:a+="&timespanFrom=&timespanTo=",CurrentAT.timeFrame?a+="&before="+toUnixDate(CurrentAT.before)+"&after="+toUnixDate(CurrentAT.after):a+="&before=&after=",CurrentAT.Tags&&0<CurrentAT.Tags.length?$.each(CurrentAT.Tags,function(t,e){a+="&tag="+e}):a+="&tag=",a+="&services=",CurrentAT.Channels&&0<CurrentAT.Channels.length){let r=[];$.each(CurrentAT.Channels,function(t,e){r.push(encodeURIComponent(e))}),a+=r.join(",")}a+="&bouquets=",CurrentAT.Bouquets&&0<CurrentAT.Bouquets.length&&(a+=CurrentAT.Bouquets.join(",")),CurrentAT.Filters&&0<CurrentAT.Filters.length&&$.each(CurrentAT.Filters,function(t,e){let r="&";"exclude"===e.t&&(r+="!"),r=(r=r+e.w+"=")+("dayofweek"===e.w?e.v:encodeURIComponent(e.v)),a+=r}),CurrentAT.vps||(CurrentAT.vpo=!1),a=(a=(a=(a+="&vps_enabled=")+(CurrentAT.vps?"1":"0")+"&vps_overwrite=")+(CurrentAT.vpso?"1":"0")+"&series_labeling=")+(CurrentAT.series_labeling?"1":"0");let t=CurrentAT.afterevent;""==t?t="default":"none"==t?t="nothing":"shutdown"==t&&(t="deepstandby"),a+="&afterevent="+t,"default"!==t&&(a=(a+="&aftereventFrom="+CurrentAT.aftereventfrom)+"&aftereventTo="+CurrentAT.aftereventto),CurrentAT.isNew||(a+="&id="+CurrentAT.id),$.ajax({type:"GET",url:a,dataType:"xml",success:function(t){var e=$(t).find("e2state").first();showError($(t).find("e2statetext").first().text(),e.text()),readAT()},error:function(t,e,r){showError(t.responseText)}})}}function test_simulateAT(t){$("#simdlg").dialog("open"),$("#simtb").append("<tr><td COLSPAN=6>"+loadspinner+"</td></tr>");let e=t?"simulate":"test";!t&&CurrentAT&&(e+="?id="+CurrentAT.id),$.ajax({type:"GET",url:"/autotimer/"+e,dataType:"xml",success:function(t){let o=[];$(t).find("e2simulatedtimer,e2testtimer").each(function(){var t="<tr>",e=(t=(t=(t=(t+="<td>"+$(this).find("e2state").text()+"</td>")+("<td>"+$(this).find("e2autotimername").text()+"</td>"))+("<td>"+$(this).find("e2name").text()+"</td>"))+("<td>"+$(this).find("e2servicename").text()+"</td>"),$(this).find("e2timebegin").text());let r=new Date(1e3*Math.round(e)),a=r.getHours(),i=r.getMinutes();var n=(9<a?"":"0")+a.toString(),s=(9<i?"":"0")+i.toString();t+="<td>"+(e=r.getMonth()+1+"/"+r.getDate()+"/"+r.getFullYear()+" "+n+":"+s)+"</td>",e=$(this).find("e2timeend").text(),r=new Date(1e3*Math.round(e)),a=r.getHours(),i=r.getMinutes(),n=(9<a?"":"0")+a.toString(),s=(9<i?"":"0")+i.toString(),t=t+"<td>"+(e=r.getMonth()+1+"/"+r.getDate()+"/"+r.getFullYear()+" "+n+":"+s)+"</td></tr>",o.push(t)}),$("#simtb").empty(),$(o).each(function(t,e){$("#simtb").append(e)}),0===o.length&&$("#simtb").append("<tr><td COLSPAN=6>NO Timer found</td></tr>")},error:function(t,e,r){showError(t.responseText)}})}function parseAT(){$.ajax({type:"GET",url:"/autotimer/parse",dataType:"xml",success:function(t){var e=$(t).find("e2state").first();showError($(t).find("e2statetext").first().text(),e.text())},error:function(t,e,r){showError(t.responseText)}})}function reloadAT(){showError(""),readAT(),$("#atlist").selectable({selected:function(t,e){$("#atlist .ui-selected").map(function(){FillAT($(this).data("id"))})},classes:{"ui-selected":getActiveCls()}})}function listTimers(){$("#timerdlg").dialog("open"),$("#timerdlgcont").html(loadspinner).load("ajax/timers #timers",function(){$("#timerdlgcont #timers .moviecontainer_main .moviecontainer_right div a:first").hide()})}function getAutoTimerSettings(){$.ajax({type:"GET",url:"/autotimer/get",dataType:"xml",success:function(t){$(t).find("e2setting").each(function(){let t=$(this).find("e2settingname").text();var e=$(this).find("e2settingvalue").text();0===t.indexOf("config.plugins.autotimer.")&&(t=t.substring(25),"True"===e?$("#ats_"+t).prop("checked",!0):"False"===e?$("#ats_"+t).prop("checked",!1):$("#ats_"+t).val(e))}),$("#atsettingdlg").dialog("open")},error:function(t,e,r){showError(t.responseText)}})}function setAutoTimerSettings(){var t="/autotimer/set?&autopoll=",e=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t+=$("#ats_autopoll").is(":checked")?"true":"")+("&interval="+$("#ats_interval").val())+"&try_guessing=")+($("#ats_try_guessing").is(":checked")?"true":"")+"&disabled_on_conflict=")+($("#ats_disabled_on_conflict").is(":checked")?"true":"")+"&addsimilar_on_conflict=")+($("#ats_addsimilar_on_conflict").is(":checked")?"true":"")+"&show_in_extensionsmenu=")+($("#ats_show_in_extensionsmenu").is(":checked")?"true":"")+"&fastscan=")+($("#ats_fastscan").is(":checked")?"true":"")+"&notifconflict=")+($("#ats_notifconflict").is(":checked")?"true":"")+"&notifsimilar=")+($("#ats_notifsimilar").is(":checked")?"true":""))+("&maxdaysinfuture="+$("#ats_maxdaysinfuture").val()),$("#ats_add_autotimer_to_tags").is(":checked")?"true":""),t=(t=(t=(t+="&add_autotimer_to_tags="+e)+("&add_name_to_tags="+(e=$("#ats_add_name_to_tags").is(":checked")?"true":"")))+("&refresh="+$("#ats_refresh").val()))+("&editor="+$("#ats_editor").val());$.ajax({type:"GET",url:t,dataType:"xml",success:function(t){var e=$(t).find("e2state").first();showError($(t).find("e2statetext").first().text(),e.text())},error:function(t,e,r){showError(t.responseText)}})}function showError(t,e){!0===(e=void 0!==e?e:"False")||"True"===e||"true"===e?($("#statusbox").removeClass("ui-state-error").addClass("ui-state-highlight"),$("#statusicon").removeClass("ui-icon-alert").addClass("ui-icon-info")):($("#statusbox").removeClass("ui-state-highlight").addClass("ui-state-error"),$("#statusicon").removeClass("ui-icon-info").addClass("ui-icon-alert")),$("#statustext").text(t),""!==t?$("#statuscont").show():$("#statuscont").hide()}function importAT(){$("#rfile").trigger("click")}function prepareRestore(t){let e=t.val();e=e.replace("C:\\fakepath\\",""),!1!==confirm(tstr_bqe_restore_question+" ( "+e+") ?")&&($("form#uploadrestore").unbind("submit").submit(function(t){var e=new FormData(this);$.ajax({url:"/autotimer/uploadfile",type:"POST",data:e,mimeType:"multipart/form-data",contentType:!1,cache:!1,processData:!1,dataType:"json",success:function(t,e,r){t=t.Result;t[0]?doRestore(t[1]):showError("Upload File: "+e)},error:function(t,e,r){showError("Upload File Error: "+r)}}),t.preventDefault();try{t.unbind()}catch(t){}}),$("form#uploadrestore").submit())}function doRestore(t){t&&$.ajax({url:"/autotimer/restore",dataType:"xml",cache:!1,success:function(t){var e=$(t).find("e2state").first();showError($(t).find("e2statetext").first().text(),e.text())}})}function exportAT(){!1!==confirm("export AT ?")&&$.ajax({url:"/autotimer/backup",dataType:"xml",cache:!1,data:{},success:function(t){"false"==$(t).find("e2state").first().text()?showError($(t).find("e2statetext").first().text()):window.open("/autotimer/tmp/autotimer_backup.tar","Download")}})}AutoTimerObj.prototype.UpdateUI=function(){$("#enabled").prop("checked",this.enabled),$("#name").val(this.name),$("#match").val(this.match),$("#searchType").val(this.searchType),$("#searchCase").val(this.searchCase),$("#justplay").val(this.justplay),$("#overrideAlternatives").prop("checked",this.overrideAlternatives),$("#timeSpan").prop("checked",this.timeSpan),$("#at_name").html("("+this.name+")"),this.timeSpan&&($("#from").val(this.from),$("#to").val(this.to)),this.maxduration?($("#maxDuration").prop("checked",!0),$("#maxduration").val(this.maxduration)):$("#maxDuration").prop("checked",!1),$("#timeFrame").prop("checked",this.timeFrame),this.timeFrame&&($("#after").val(this.after),$("#before").val(this.before),$("#before").datepicker("getDate")<new Date(2038,0,1)?($("#timeFrameAfter").prop("checked",!0),$("#beforeE").show()):($("#timeFrameAfter").prop("checked",!1),$("#beforeE").hide())),$("#avoidDuplicateDescription").val(this.avoidDuplicateDescription),this.location?($("#location").val(this.location),this.location!==$("#location").val()&&(t="<option value='"+this.location+"'>"+this.location+"</option>",$("#location").append(t),$("#location").val(this.location)),$("#Location").prop("checked",!0)):$("#Location").prop("checked",!1),$("#timerOffset").prop("checked",this.timerOffset),this.timerOffset&&($("#tafter").val(this.timerOffsetAfter),$("#tbefore").val(this.timerOffsetBefore)),$("#timeSpanAE").prop("checked",!1),$("#afterevent").val(""),this.afterevent&&($("#afterevent").val(this.afterevent),this.aftereventfrom)&&this.aftereventto&&($("#aefrom").val(this.aftereventfrom),$("#aeto").val(this.aftereventto),$("#timeSpanAE").prop("checked",!0)),$("#channels").val(null),$("#bouquets").val(null),$.each(this.Bouquets,function(t,e){$('#bouquets option[value="'+e+'"]').prop("selected",!0)}),$.each(this.Channels,function(t,e){$('#channels option[value="'+e+'"]').prop("selected",!0)}),$("#Bouquets").prop("checked",0<this.Bouquets.length),$("#Channels").prop("checked",0<this.Channels.length),$("#tags").val(null),$.each(this.Tags,function(t,e){$('#tags option[value="'+e+'"]').prop("selected",!0)}),$("#bouquets").trigger("chosen:updated"),$("#channels").trigger("chosen:updated"),$("#tags").trigger("chosen:updated");var t,e=$("#filterlist tr").length;if(1<e)for(let t=1;t<e;t++)$("#f"+t.toString()).remove();let r=0;$.each(this.Filters,function(t,e){r++,AddFilter(e.t,e.w,e.v)}),$("#Filter").prop("checked",0<r),$("#counter").val(this.counter),$("#left").val(this.left),$("#counterFormat").val(this.counterFormat),$("#vps").prop("checked",this.vps),$("#vpssm").prop("checked",!this.vpso),$("#series_labeling").prop("checked",this.series_labeling),checkValues()};