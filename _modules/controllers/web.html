

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>controllers.web &mdash; OpenWebif 2.2.2 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=219dea72"></script>
      <script src="../../_static/doctools.js?v=9a2dae69"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            OpenWebif
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../common.html">Common</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../controller.html">Controller</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">OpenWebif</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">controllers.web</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for controllers.web</h1><div class="highlight"><pre>
<span></span><span class="c1">##########################################################################</span>
<span class="c1"># OpenWebif: WebController</span>
<span class="c1">##########################################################################</span>
<span class="c1"># Copyright (C) 2011 - 2022 E2OpenPlugins</span>
<span class="c1">#</span>
<span class="c1"># This program is free software; you can redistribute it and/or modify it</span>
<span class="c1"># under the terms of the GNU General Public License as published by</span>
<span class="c1"># the Free Software Foundation; either version 3 of the License, or</span>
<span class="c1"># (at your option) any later version.</span>
<span class="c1">#</span>
<span class="c1"># This program is distributed in the hope that it will be useful,</span>
<span class="c1"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span>
<span class="c1"># GNU General Public License for more details.</span>
<span class="c1">#</span>
<span class="c1"># You should have received a copy of the GNU General Public License</span>
<span class="c1"># along with this program; if not, write to the Free Software Foundation,</span>
<span class="c1"># Inc., 51 Franklin Street, Fifth Floor, Boston MA 02110-1301, USA.</span>
<span class="c1">##########################################################################</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">re</span><span class="w"> </span><span class="kn">import</span> <span class="n">match</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">os.path</span><span class="w"> </span><span class="kn">import</span> <span class="n">isfile</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">Components.config</span><span class="w"> </span><span class="kn">import</span> <span class="n">config</span> <span class="k">as</span> <span class="n">comp_config</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">Screens.InfoBar</span><span class="w"> </span><span class="kn">import</span> <span class="n">InfoBar</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">.models.info</span><span class="w"> </span><span class="kn">import</span> <span class="n">getInfo</span><span class="p">,</span> <span class="n">getCurrentTime</span><span class="p">,</span> <span class="n">getStatusInfo</span><span class="p">,</span> <span class="n">getFrontendStatus</span><span class="p">,</span> <span class="n">testPipStatus</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.models.services</span><span class="w"> </span><span class="kn">import</span> <span class="n">getCurrentService</span><span class="p">,</span> <span class="n">getBouquets</span><span class="p">,</span> <span class="n">getServices</span><span class="p">,</span> <span class="n">getSubServices</span><span class="p">,</span> <span class="n">getSatellites</span><span class="p">,</span> <span class="n">getBouquetEpg</span><span class="p">,</span> <span class="n">getBouquetNowNextEpg</span><span class="p">,</span> <span class="n">getMultiChannelNowNextEpg</span><span class="p">,</span> <span class="n">getSearchEpg</span><span class="p">,</span> <span class="n">getSimilarEpg</span><span class="p">,</span> <span class="n">getChannelEpg</span><span class="p">,</span> <span class="n">getNowNextEpg</span><span class="p">,</span> <span class="n">getAllServices</span><span class="p">,</span> <span class="n">getPlayableServices</span><span class="p">,</span> <span class="n">getPlayableService</span><span class="p">,</span> <span class="n">getParentalControlList</span><span class="p">,</span> <span class="n">getEvent</span><span class="p">,</span> <span class="n">getServiceRef</span><span class="p">,</span> <span class="n">getPicon</span><span class="p">,</span> <span class="n">getAllServicesRaw</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.models.volume</span><span class="w"> </span><span class="kn">import</span> <span class="n">getVolumeStatus</span><span class="p">,</span> <span class="n">setVolumeUp</span><span class="p">,</span> <span class="n">setVolumeDown</span><span class="p">,</span> <span class="n">setVolumeMute</span><span class="p">,</span> <span class="n">setVolume</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.models.audiotrack</span><span class="w"> </span><span class="kn">import</span> <span class="n">getAudioTracks</span><span class="p">,</span> <span class="n">setAudioTrack</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.models.control</span><span class="w"> </span><span class="kn">import</span> <span class="n">zapService</span><span class="p">,</span> <span class="n">remoteControl</span><span class="p">,</span> <span class="n">setPowerState</span><span class="p">,</span> <span class="n">getStandbyState</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.models.locations</span><span class="w"> </span><span class="kn">import</span> <span class="n">getLocations</span><span class="p">,</span> <span class="n">getCurrentLocation</span><span class="p">,</span> <span class="n">addLocation</span><span class="p">,</span> <span class="n">removeLocation</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.models.timers</span><span class="w"> </span><span class="kn">import</span> <span class="n">getTimers</span><span class="p">,</span> <span class="n">addTimer</span><span class="p">,</span> <span class="n">addTimerByEventId</span><span class="p">,</span> <span class="n">editTimer</span><span class="p">,</span> <span class="n">removeTimer</span><span class="p">,</span> <span class="n">toggleTimerStatus</span><span class="p">,</span> <span class="n">cleanupTimer</span><span class="p">,</span> <span class="n">writeTimerList</span><span class="p">,</span> <span class="n">recordNow</span><span class="p">,</span> <span class="n">tvbrowser</span><span class="p">,</span> <span class="n">getSleepTimer</span><span class="p">,</span> <span class="n">setSleepTimer</span><span class="p">,</span> <span class="n">getPowerTimer</span><span class="p">,</span> <span class="n">setPowerTimer</span><span class="p">,</span> <span class="n">getVPSChannels</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.models.message</span><span class="w"> </span><span class="kn">import</span> <span class="n">sendMessage</span><span class="p">,</span> <span class="n">getMessageAnswer</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.models.movies</span><span class="w"> </span><span class="kn">import</span> <span class="n">getMovieList</span><span class="p">,</span> <span class="n">removeMovie</span><span class="p">,</span> <span class="n">getMovieInfo</span><span class="p">,</span> <span class="n">movieAction</span><span class="p">,</span> <span class="n">getAllMovies</span><span class="p">,</span> <span class="n">getMovieDetails</span><span class="p">,</span> <span class="n">setMovieResumePoint</span><span class="p">,</span> <span class="n">MOVIETAGFILE</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.models.config</span><span class="w"> </span><span class="kn">import</span> <span class="n">getSettings</span><span class="p">,</span> <span class="n">addCollapsedMenu</span><span class="p">,</span> <span class="n">removeCollapsedMenu</span><span class="p">,</span> <span class="n">saveConfig</span><span class="p">,</span> <span class="n">getConfigs</span><span class="p">,</span> <span class="n">getConfigsSections</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.models.stream</span><span class="w"> </span><span class="kn">import</span> <span class="n">getStream</span><span class="p">,</span> <span class="n">getTS</span><span class="p">,</span> <span class="n">getStreamSubservices</span><span class="p">,</span> <span class="n">GetSession</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.models.servicelist</span><span class="w"> </span><span class="kn">import</span> <span class="n">reloadServicesLists</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.models.mediaplayer</span><span class="w"> </span><span class="kn">import</span> <span class="n">mediaPlayerAdd</span><span class="p">,</span> <span class="n">mediaPlayerRemove</span><span class="p">,</span> <span class="n">mediaPlayerPlay</span><span class="p">,</span> <span class="n">mediaPlayerCommand</span><span class="p">,</span> <span class="n">mediaPlayerCurrent</span><span class="p">,</span> <span class="n">mediaPlayerList</span><span class="p">,</span> <span class="n">mediaPlayerLoad</span><span class="p">,</span> <span class="n">mediaPlayerSave</span><span class="p">,</span> <span class="n">mediaPlayerFindFile</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.models.plugins</span><span class="w"> </span><span class="kn">import</span> <span class="n">reloadPlugins</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">.i18n</span><span class="w"> </span><span class="kn">import</span> <span class="n">_</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.base</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseController</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.stream</span><span class="w"> </span><span class="kn">import</span> <span class="n">StreamController</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.utilities</span><span class="w"> </span><span class="kn">import</span> <span class="n">getUrlArg</span><span class="p">,</span> <span class="n">toBinary</span><span class="p">,</span> <span class="n">toString</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.defaults</span><span class="w"> </span><span class="kn">import</span> <span class="n">PICON_PATH</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.models.epg</span><span class="w"> </span><span class="kn">import</span> <span class="n">EPG</span>


<span class="k">def</span><span class="w"> </span><span class="nf">whoami</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
	<span class="n">port</span> <span class="o">=</span> <span class="n">comp_config</span><span class="o">.</span><span class="n">OpenWebif</span><span class="o">.</span><span class="n">port</span><span class="o">.</span><span class="n">value</span>
	<span class="n">proto</span> <span class="o">=</span> <span class="s1">&#39;http&#39;</span>
	<span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">isSecure</span><span class="p">():</span>
		<span class="n">port</span> <span class="o">=</span> <span class="n">comp_config</span><span class="o">.</span><span class="n">OpenWebif</span><span class="o">.</span><span class="n">https_port</span><span class="o">.</span><span class="n">value</span>
		<span class="n">proto</span> <span class="o">=</span> <span class="s1">&#39;https&#39;</span>
	<span class="n">ourhost</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">getHeader</span><span class="p">(</span><span class="s1">&#39;host&#39;</span><span class="p">)</span>
	<span class="n">m</span> <span class="o">=</span> <span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;.+\:(\d+)$&#39;</span><span class="p">,</span> <span class="n">ourhost</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">m</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
		<span class="n">port</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
	<span class="k">return</span> <span class="p">{</span><span class="s1">&#39;proto&#39;</span><span class="p">:</span> <span class="n">proto</span><span class="p">,</span> <span class="s1">&#39;port&#39;</span><span class="p">:</span> <span class="n">port</span><span class="p">}</span>


<div class="viewcode-block" id="WebController">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">WebController</span><span class="p">(</span><span class="n">BaseController</span><span class="p">):</span>
<span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	HTTP Web Controller</span>

<span class="sd">	Fork of *Enigma2 WebInterface API* as described in e.g.</span>
<span class="sd">	https://dream.reichholf.net/e2web/.</span>
<span class="sd">	&quot;&quot;&quot;</span>

	<span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">session</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
		<span class="n">BaseController</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">putChild</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;stream&quot;</span><span class="p">,</span> <span class="n">StreamController</span><span class="p">(</span><span class="n">session</span><span class="p">))</span>

	<span class="k">def</span><span class="w"> </span><span class="nf">prePageLoad</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
		<span class="n">request</span><span class="o">.</span><span class="n">setHeader</span><span class="p">(</span><span class="s2">&quot;Access-Control-Allow-Origin&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">)</span>
		<span class="n">request</span><span class="o">.</span><span class="n">setHeader</span><span class="p">(</span><span class="s2">&quot;content-type&quot;</span><span class="p">,</span> <span class="s2">&quot;text/xml&quot;</span><span class="p">)</span>

	<span class="k">def</span><span class="w"> </span><span class="nf">testMandatoryArguments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">keys</span><span class="p">):</span>
		<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
			<span class="n">k</span> <span class="o">=</span> <span class="n">toBinary</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
				<span class="k">return</span> <span class="p">{</span>
					<span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
					<span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Missing mandatory parameter &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="n">key</span>
				<span class="p">}</span>

			<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
				<span class="k">return</span> <span class="p">{</span>
					<span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
					<span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;The parameter &#39;</span><span class="si">%s</span><span class="s2">&#39; can&#39;t be empty&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="n">key</span>
				<span class="p">}</span>

		<span class="k">return</span> <span class="kc">None</span>

<div class="viewcode-block" id="WebController.P_tsstart">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_tsstart">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_tsstart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `tsstart` endpoint.</span>
<span class="sd">		Start timeshift (?).</span>

<span class="sd">		.. note::</span>

<span class="sd">			Not available in *Enigma2 WebInterface API*.</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">success</span> <span class="o">=</span> <span class="kc">True</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">InfoBar</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">startTimeshift</span><span class="p">()</span>
		<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>  <span class="c1"># nosec # noqa: E722</span>
			<span class="n">success</span> <span class="o">=</span> <span class="kc">False</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">P_tsstate</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">success</span><span class="p">)</span></div>


<div class="viewcode-block" id="WebController.P_tsstop">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_tsstop">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_tsstop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `tsstop` endpoint.</span>
<span class="sd">		Stop timeshift (?).</span>

<span class="sd">		.. note::</span>

<span class="sd">			Not available in *Enigma2 WebInterface API*.</span>

<span class="sd">		*TODO: improve after action / save , save+record , nothing</span>
<span class="sd">		config.timeshift.favoriteSaveAction ....*</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">success</span> <span class="o">=</span> <span class="kc">True</span>
		<span class="n">oldcheck</span> <span class="o">=</span> <span class="kc">False</span>
		<span class="n">configitem</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">comp_config</span><span class="o">.</span><span class="n">timeshift</span><span class="p">,</span> <span class="s2">&quot;check&quot;</span><span class="p">):</span>
			<span class="n">configitem</span> <span class="o">=</span> <span class="n">comp_config</span><span class="o">.</span><span class="n">timeshift</span><span class="o">.</span><span class="n">check</span>
		<span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">comp_config</span><span class="o">.</span><span class="n">usage</span><span class="p">,</span> <span class="s2">&quot;check_timeshift&quot;</span><span class="p">):</span>
			<span class="n">configitem</span> <span class="o">=</span> <span class="n">comp_config</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">check_timeshift</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">configitem</span> <span class="ow">and</span> <span class="n">configitem</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
				<span class="n">oldcheck</span> <span class="o">=</span> <span class="n">configitem</span><span class="o">.</span><span class="n">value</span>
				<span class="c1"># don&#39;t ask but also don&#39;t save</span>
				<span class="n">configitem</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">False</span>
				<span class="n">configitem</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
			<span class="n">InfoBar</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">stopTimeshift</span><span class="p">()</span>
		<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>  <span class="c1"># nosec # noqa: E722</span>
			<span class="n">success</span> <span class="o">=</span> <span class="kc">False</span>
		<span class="k">if</span> <span class="n">configitem</span> <span class="ow">and</span> <span class="n">configitem</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
			<span class="n">configitem</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">oldcheck</span>
			<span class="n">configitem</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">P_tsstate</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">success</span><span class="p">)</span></div>


<div class="viewcode-block" id="WebController.P_tsstate">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_tsstate">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_tsstate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">success</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `tsstate` endpoint.</span>
<span class="sd">		Retrieve timeshift status(?).</span>

<span class="sd">		.. note::</span>

<span class="sd">			Not available in *Enigma2 WebInterface API*.</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="p">{</span>
			<span class="s2">&quot;state&quot;</span><span class="p">:</span> <span class="n">success</span><span class="p">,</span>
			<span class="s2">&quot;timeshiftEnabled&quot;</span><span class="p">:</span> <span class="n">InfoBar</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">timeshiftEnabled</span><span class="p">()</span>
		<span class="p">}</span></div>


<div class="viewcode-block" id="WebController.P_about">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_about">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_about</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `about` endpoint.</span>

<span class="sd">		.. seealso::</span>

<span class="sd">			https://github.com/oe-alliance/OpenWebif/wiki/OpenWebif-API-documentation#about</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="p">{</span>
			<span class="s2">&quot;info&quot;</span><span class="p">:</span> <span class="n">getInfo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="n">need_fullinfo</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
			<span class="s2">&quot;service&quot;</span><span class="p">:</span> <span class="n">getCurrentService</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">)</span>
		<span class="p">}</span></div>


	<span class="k">def</span><span class="w"> </span><span class="nf">P_statusinfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
		<span class="c1"># we don&#39;t need to fill logs with this api (it&#39;s called too many times)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">suppresslog</span> <span class="o">=</span> <span class="kc">True</span>
		<span class="k">return</span> <span class="n">getStatusInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

	<span class="k">def</span><span class="w"> </span><span class="nf">P_pipinfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
		<span class="k">return</span> <span class="n">testPipStatus</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

<div class="viewcode-block" id="WebController.P_tunersignal">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_tunersignal">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_tunersignal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `tunersignal` endpoint.</span>
<span class="sd">		Get tuner signal status(?)</span>

<span class="sd">		.. seealso::</span>

<span class="sd">			https://github.com/oe-alliance/OpenWebif/wiki/OpenWebif-API-documentation#signal</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>

<span class="sd">		.. http:get:: /web/signal</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="n">getFrontendStatus</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">)</span></div>


<div class="viewcode-block" id="WebController.P_vol">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_vol">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_vol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `vol` endpoint.</span>
<span class="sd">		Get/Set current volume setting.</span>

<span class="sd">		.. seealso::</span>

<span class="sd">			https://github.com/oe-alliance/OpenWebif/wiki/OpenWebif-API-documentation#vol</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">_set</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;set&quot;</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">_set</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">_set</span> <span class="o">==</span> <span class="s2">&quot;state&quot;</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">getVolumeStatus</span><span class="p">()</span>
		<span class="k">elif</span> <span class="n">_set</span> <span class="o">==</span> <span class="s2">&quot;up&quot;</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">setVolumeUp</span><span class="p">()</span>
		<span class="k">elif</span> <span class="n">_set</span> <span class="o">==</span> <span class="s2">&quot;down&quot;</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">setVolumeDown</span><span class="p">()</span>
		<span class="k">elif</span> <span class="n">_set</span> <span class="o">==</span> <span class="s2">&quot;mute&quot;</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">setVolumeMute</span><span class="p">()</span>
		<span class="k">elif</span> <span class="n">_set</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;set&quot;</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="k">return</span> <span class="n">setVolume</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">_set</span><span class="p">[</span><span class="mi">3</span><span class="p">:]))</span>
			<span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>  <span class="c1"># nosec # noqa: E722</span>
				<span class="n">res</span> <span class="o">=</span> <span class="n">getVolumeStatus</span><span class="p">()</span>
				<span class="n">res</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
				<span class="n">res</span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Wrong parameter format &#39;set=</span><span class="si">%s</span><span class="s2">&#39;. Use set=set15 &quot;</span><span class="p">)</span> <span class="o">%</span> <span class="n">_set</span>
				<span class="k">return</span> <span class="n">res</span>

		<span class="n">res</span> <span class="o">=</span> <span class="n">getVolumeStatus</span><span class="p">()</span>
		<span class="n">res</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
		<span class="n">res</span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Unknown Volume command </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="n">_set</span>
		<span class="k">return</span> <span class="n">res</span></div>


<div class="viewcode-block" id="WebController.P_getaudiotracks">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_getaudiotracks">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_getaudiotracks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `/getaudiotracks` endpoint.</span>

<span class="sd">		.. seealso::</span>

<span class="sd">			https://github.com/oe-alliance/OpenWebif/wiki/OpenWebif-API-documentation#getaudiotracks</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="n">getAudioTracks</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">)</span></div>


<div class="viewcode-block" id="WebController.P_selectaudiotrack">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_selectaudiotrack">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_selectaudiotrack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `/selectaudiotrack` endpoint.</span>

<span class="sd">		.. seealso::</span>

<span class="sd">			https://github.com/oe-alliance/OpenWebif/wiki/OpenWebif-API-documentation#selectaudiotrack</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>

<span class="sd">		.. http:get:: /web/signal</span>

<span class="sd">			:query int id: audio track ID</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">audioid</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="sa">b</span><span class="s2">&quot;id&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
		<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>  <span class="c1"># nosec # noqa: E722</span>
			<span class="n">audioid</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

		<span class="k">return</span> <span class="n">setAudioTrack</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="n">audioid</span><span class="p">)</span></div>


<div class="viewcode-block" id="WebController.P_zap">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_zap">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_zap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `/zap` endpoint.</span>
<span class="sd">		Zap to requested service_reference.</span>

<span class="sd">		.. seealso::</span>

<span class="sd">			https://github.com/oe-alliance/OpenWebif/wiki/OpenWebif-API-documentation#zap</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>

<span class="sd">		.. http:get:: /web/zap</span>

<span class="sd">			:query string sRef: service reference</span>
<span class="sd">			:query string title: service title</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testMandatoryArguments</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;sRef&quot;</span><span class="p">])</span>
		<span class="k">if</span> <span class="n">res</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">res</span>

		<span class="n">title</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
		<span class="n">sref</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;sRef&quot;</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">zapService</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="n">sref</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span></div>


<div class="viewcode-block" id="WebController.P_remotecontrol">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_remotecontrol">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_remotecontrol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `remotecontrol` endpoint.</span>
<span class="sd">		Send remote control codes.</span>

<span class="sd">		.. seealso::</span>

<span class="sd">			https://github.com/oe-alliance/OpenWebif/wiki/OpenWebif-API-documentation#remotecontrol</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>
<span class="sd">		&quot;&quot;&quot;</span>

		<span class="n">text</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">text</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">remoteControl</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>  <span class="c1"># text input do not need type and command</span>

		<span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testMandatoryArguments</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;command&quot;</span><span class="p">])</span>
		<span class="k">if</span> <span class="n">res</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">res</span>

		<span class="n">key</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">key</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="sa">b</span><span class="s2">&quot;command&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
		<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>  <span class="c1"># nosec # noqa: E722</span>
			<span class="k">return</span> <span class="p">{</span>
				<span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
				<span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;The parameter &#39;command&#39; must be a number&quot;</span><span class="p">)</span>
			<span class="p">}</span>

		<span class="n">rctype</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
		<span class="n">rcu</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;rcu&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

		<span class="k">return</span> <span class="n">remoteControl</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">rctype</span><span class="p">,</span> <span class="n">rcu</span><span class="p">)</span></div>


<div class="viewcode-block" id="WebController.P_powerstate">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_powerstate">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_powerstate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `powerstate` endpoint.</span>
<span class="sd">		Get/set power state of enigma2 device.</span>

<span class="sd">		.. seealso::</span>

<span class="sd">			https://github.com/oe-alliance/OpenWebif/wiki/OpenWebif-API-documentation#powerstate</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="sa">b</span><span class="s2">&quot;shift&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">P_set_powerup_without_waking_tv</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
		<span class="n">newstate</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;newstate&quot;</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">newstate</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">setPowerState</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="n">newstate</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">getStandbyState</span><span class="p">()</span></div>


<div class="viewcode-block" id="WebController.P_supports_powerup_without_waking_tv">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_supports_powerup_without_waking_tv">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_supports_powerup_without_waking_tv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `supports_powerup_without_waking_tv` endpoint.</span>
<span class="sd">		Check if &#39;powerup without waking TV&#39; is available.</span>

<span class="sd">		.. note::</span>

<span class="sd">			Not available in *Enigma2 WebInterface API*.</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="c1"># returns &#39;True&#39; if the image supports the function &quot;Power on without TV&quot;:</span>
			<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;/tmp/powerup_without_waking_tv.txt&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>  <span class="c1"># nosec</span>
				<span class="n">powerupwithoutwakingtv</span> <span class="o">=</span> <span class="n">fd</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
			<span class="k">if</span> <span class="p">((</span><span class="n">powerupwithoutwakingtv</span> <span class="o">==</span> <span class="s1">&#39;True&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">powerupwithoutwakingtv</span> <span class="o">==</span> <span class="s1">&#39;False&#39;</span><span class="p">)):</span>
				<span class="k">return</span> <span class="kc">True</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">return</span> <span class="kc">False</span>
		<span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>  <span class="c1"># nosec # noqa: E722</span>
			<span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="WebController.P_set_powerup_without_waking_tv">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_set_powerup_without_waking_tv">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_set_powerup_without_waking_tv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `set_powerup_without_waking_tv` endpoint.</span>
<span class="sd">		Mark &#39;powerup without waking TV&#39; being available.</span>

<span class="sd">		.. note::</span>

<span class="sd">			Not available in *Enigma2 WebInterface API*.</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">P_supports_powerup_without_waking_tv</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="c1"># write &quot;True&quot; to file so that the box will power on ONCE skipping the HDMI-CEC communication:</span>
				<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;/tmp/powerup_without_waking_tv.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>  <span class="c1"># nosec</span>
					<span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;True&#39;</span><span class="p">)</span>
				<span class="k">return</span> <span class="kc">True</span>
			<span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>  <span class="c1"># nosec # noqa: E722</span>
				<span class="k">return</span> <span class="kc">False</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="WebController.P_getlocations">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_getlocations">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_getlocations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `getlocations` endpoint.</span>
<span class="sd">		Retrieve paths where video files are stored.</span>

<span class="sd">		.. seealso::</span>

<span class="sd">			https://github.com/oe-alliance/OpenWebif/wiki/OpenWebif-API-documentation#getlocations</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="n">getLocations</span><span class="p">()</span></div>


<div class="viewcode-block" id="WebController.P_getcurrlocation">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_getcurrlocation">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_getcurrlocation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `getcurrlocation` endpoint.</span>
<span class="sd">		Get currently selected path where video files are to be stored.</span>

<span class="sd">		.. seealso::</span>

<span class="sd">			https://github.com/oe-alliance/OpenWebif/wiki/OpenWebif-API-documentation#getcurrlocation</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="n">getCurrentLocation</span><span class="p">()</span></div>


	<span class="k">def</span><span class="w"> </span><span class="nf">P_allservicescsv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
		<span class="n">mode</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;mode&quot;</span><span class="p">,</span> <span class="s2">&quot;all&quot;</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">getAllServicesRaw</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="n">csv</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

	<span class="k">def</span><span class="w"> </span><span class="nf">P_allservices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
		<span class="n">mode</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;mode&quot;</span><span class="p">,</span> <span class="s2">&quot;all&quot;</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">getAllServicesRaw</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>

<div class="viewcode-block" id="WebController.P_getallservices">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_getallservices">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_getallservices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `getallservices` endpoint.</span>
<span class="sd">		Retrieve list of services in bouquets.</span>

<span class="sd">		.. seealso::</span>

<span class="sd">			https://github.com/oe-alliance/OpenWebif/wiki/OpenWebif-API-documentation#getallservices</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;tv&quot;</span>
		<span class="k">if</span> <span class="sa">b</span><span class="s2">&quot;type&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
			<span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;radio&quot;</span>

		<span class="n">noiptv</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;noiptv&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">False</span>

		<span class="n">nolastscanned</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;nolastscanned&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">False</span>

		<span class="n">removenamefromsref</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;removenamefromsref&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">False</span>

		<span class="n">showall</span> <span class="o">=</span> <span class="kc">False</span> <span class="k">if</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;showall&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="s2">&quot;false&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">True</span>

		<span class="n">showproviders</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;showproviders&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">False</span>

		<span class="n">excludes</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;exclude&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
		<span class="n">excludes</span> <span class="o">=</span> <span class="n">excludes</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
		<span class="n">excludeprogram</span> <span class="o">=</span> <span class="s2">&quot;program&quot;</span> <span class="ow">in</span> <span class="n">excludes</span>
		<span class="n">excludevod</span> <span class="o">=</span> <span class="s2">&quot;vod&quot;</span> <span class="ow">in</span> <span class="n">excludes</span>
		<span class="n">excludeiptv</span> <span class="o">=</span> <span class="s2">&quot;iptv&quot;</span> <span class="ow">in</span> <span class="n">excludes</span>
		<span class="n">excludelastscanned</span> <span class="o">=</span> <span class="s2">&quot;lastscanned&quot;</span> <span class="ow">in</span> <span class="n">excludes</span>
		<span class="n">showstreamrelay</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;showstreamrelay&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">False</span>

		<span class="n">bouquets</span> <span class="o">=</span> <span class="n">getAllServices</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="n">noiptv</span><span class="o">=</span><span class="n">noiptv</span> <span class="ow">or</span> <span class="n">excludeiptv</span><span class="p">,</span> <span class="n">nolastscanned</span><span class="o">=</span><span class="n">nolastscanned</span> <span class="ow">or</span> <span class="n">excludelastscanned</span><span class="p">,</span> <span class="n">removenamefromsref</span><span class="o">=</span><span class="n">removenamefromsref</span><span class="p">,</span> <span class="n">showall</span><span class="o">=</span><span class="n">showall</span><span class="p">,</span> <span class="n">showproviders</span><span class="o">=</span><span class="n">showproviders</span><span class="p">,</span> <span class="n">excludeprogram</span><span class="o">=</span><span class="n">excludeprogram</span><span class="p">,</span> <span class="n">excludevod</span><span class="o">=</span><span class="n">excludevod</span><span class="p">,</span> <span class="n">showstreamrelay</span><span class="o">=</span><span class="n">showstreamrelay</span><span class="p">)</span>
		<span class="k">if</span> <span class="sa">b</span><span class="s2">&quot;renameserviceforxmbc&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
			<span class="k">for</span> <span class="n">bouquet</span> <span class="ow">in</span> <span class="n">bouquets</span><span class="p">[</span><span class="s2">&quot;services&quot;</span><span class="p">]:</span>
				<span class="k">for</span> <span class="n">service</span> <span class="ow">in</span> <span class="n">bouquet</span><span class="p">[</span><span class="s2">&quot;subservices&quot;</span><span class="p">]:</span>
					<span class="k">if</span> <span class="ow">not</span> <span class="nb">int</span><span class="p">(</span><span class="n">service</span><span class="p">[</span><span class="s2">&quot;servicereference&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&amp;</span> <span class="mi">64</span><span class="p">:</span>
						<span class="n">service</span><span class="p">[</span><span class="s2">&quot;servicename&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">service</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">service</span><span class="p">[</span><span class="s1">&#39;servicename&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
		<span class="k">return</span> <span class="n">bouquets</span></div>


<div class="viewcode-block" id="WebController.P_getservices">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_getservices">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_getservices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `getservices` endpoint.</span>
<span class="sd">		Retrieve list of bouquets.</span>

<span class="sd">		.. seealso::</span>

<span class="sd">			https://github.com/oe-alliance/OpenWebif/wiki/OpenWebif-API-documentation#getservices</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">sref</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;sRef&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
		<span class="n">hidden</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;hidden&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">False</span>
		<span class="n">showproviders</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;showproviders&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">False</span>
		<span class="c1"># FALLBACK for old 3rd party tools</span>
		<span class="k">if</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;provider&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;1&quot;</span><span class="p">:</span>
			<span class="n">showproviders</span> <span class="o">=</span> <span class="kc">True</span>
		<span class="n">picon</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;picon&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">False</span>
		<span class="n">removenamefromsref</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;removenamefromsref&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">False</span>
		<span class="n">showstreamrelay</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;showstreamrelay&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">False</span>
		<span class="n">noiptv</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;noiptv&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">False</span>
		<span class="n">showall</span> <span class="o">=</span> <span class="kc">False</span> <span class="k">if</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;showall&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="s2">&quot;false&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">True</span>
		<span class="k">return</span> <span class="n">getServices</span><span class="p">(</span><span class="n">sref</span><span class="o">=</span><span class="n">sref</span><span class="p">,</span> <span class="n">showall</span><span class="o">=</span><span class="n">showall</span><span class="p">,</span> <span class="n">showhidden</span><span class="o">=</span><span class="n">hidden</span><span class="p">,</span> <span class="n">showproviders</span><span class="o">=</span><span class="n">showproviders</span><span class="p">,</span> <span class="n">picon</span><span class="o">=</span><span class="n">picon</span><span class="p">,</span> <span class="n">removenamefromsref</span><span class="o">=</span><span class="n">removenamefromsref</span><span class="p">,</span> <span class="n">noiptv</span><span class="o">=</span><span class="n">noiptv</span><span class="p">,</span> <span class="n">showstreamrelay</span><span class="o">=</span><span class="n">showstreamrelay</span><span class="p">)</span></div>


<div class="viewcode-block" id="WebController.P_servicesxspf">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_servicesxspf">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_servicesxspf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `servicesxspf` endpoint.</span>
<span class="sd">		Retrieve list of bouquets(?) in XSPF format.</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>

<span class="sd">		.. http:get:: /web/services.xspf</span>

<span class="sd">			:query string bRef: bouquet reference</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">bref</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;bRef&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
		<span class="n">request</span><span class="o">.</span><span class="n">setHeader</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="s1">&#39;application/xspf+xml&#39;</span><span class="p">)</span>
		<span class="n">bouquetname</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;bName&quot;</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">bouquetname</span><span class="p">:</span>
			<span class="n">bouquetname</span> <span class="o">=</span> <span class="n">bouquetname</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
			<span class="n">request</span><span class="o">.</span><span class="n">setHeader</span><span class="p">(</span><span class="s1">&#39;Content-Disposition&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;inline; filename=</span><span class="si">{</span><span class="n">bouquetname</span><span class="si">}</span><span class="s1">.xspf;&#39;</span><span class="p">)</span>
		<span class="n">services</span> <span class="o">=</span> <span class="n">getServices</span><span class="p">(</span><span class="n">bref</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">comp_config</span><span class="o">.</span><span class="n">OpenWebif</span><span class="o">.</span><span class="n">auth_for_streaming</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
			<span class="n">session</span> <span class="o">=</span> <span class="n">GetSession</span><span class="p">()</span>
			<span class="k">if</span> <span class="n">session</span><span class="o">.</span><span class="n">GetAuth</span><span class="p">(</span><span class="n">request</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
				<span class="n">auth</span> <span class="o">=</span> <span class="s1">&#39;:&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">GetAuth</span><span class="p">(</span><span class="n">request</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;@&quot;</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">auth</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;-sid:</span><span class="si">{</span><span class="n">session</span><span class="o">.</span><span class="n">GetSID</span><span class="p">(</span><span class="n">request</span><span class="p">)</span><span class="si">}</span><span class="s2">@&quot;</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">auth</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
		<span class="n">portnumber</span> <span class="o">=</span> <span class="n">comp_config</span><span class="o">.</span><span class="n">OpenWebif</span><span class="o">.</span><span class="n">streamport</span><span class="o">.</span><span class="n">value</span>
		<span class="n">services</span><span class="p">[</span><span class="s2">&quot;host&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">request</span><span class="o">.</span><span class="n">getRequestHostname</span><span class="p">()</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">portnumber</span><span class="si">}</span><span class="s2">&quot;</span>
		<span class="n">services</span><span class="p">[</span><span class="s2">&quot;auth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">auth</span>
		<span class="n">services</span><span class="p">[</span><span class="s2">&quot;bname&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bouquetname</span>
		<span class="k">return</span> <span class="n">services</span></div>


<div class="viewcode-block" id="WebController.P_servicesm3u">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_servicesm3u">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_servicesm3u</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `servicesm3u` endpoint.</span>
<span class="sd">		Retrieve list of bouquets(?) in M3U format.</span>

<span class="sd">		.. seealso::</span>

<span class="sd">			https://github.com/oe-alliance/OpenWebif/wiki/OpenWebif-API-documentation#servicesm3u</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>

<span class="sd">		.. http:get:: /web/services.m3u</span>

<span class="sd">			:query string bRef: bouquet reference</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">bref</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;bRef&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
		<span class="n">request</span><span class="o">.</span><span class="n">setHeader</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="s1">&#39;application/x-mpegurl&#39;</span><span class="p">)</span>
		<span class="n">bouquetname</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;bName&quot;</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">bouquetname</span><span class="p">:</span>
			<span class="n">bouquetname</span> <span class="o">=</span> <span class="n">bouquetname</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
			<span class="n">request</span><span class="o">.</span><span class="n">setHeader</span><span class="p">(</span><span class="s1">&#39;Content-Disposition&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;inline; filename=</span><span class="si">{</span><span class="n">bouquetname</span><span class="si">}</span><span class="s1">.m3u8;&#39;</span><span class="p">)</span>
		<span class="n">services</span> <span class="o">=</span> <span class="n">getServices</span><span class="p">(</span><span class="n">bref</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">comp_config</span><span class="o">.</span><span class="n">OpenWebif</span><span class="o">.</span><span class="n">auth_for_streaming</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
			<span class="n">session</span> <span class="o">=</span> <span class="n">GetSession</span><span class="p">()</span>
			<span class="k">if</span> <span class="n">session</span><span class="o">.</span><span class="n">GetAuth</span><span class="p">(</span><span class="n">request</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
				<span class="n">auth</span> <span class="o">=</span> <span class="s1">&#39;:&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">GetAuth</span><span class="p">(</span><span class="n">request</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;@&quot;</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">auth</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;-sid:</span><span class="si">{</span><span class="n">session</span><span class="o">.</span><span class="n">GetSID</span><span class="p">(</span><span class="n">request</span><span class="p">)</span><span class="si">}</span><span class="s2">@&quot;</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">auth</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
		<span class="n">portnumber</span> <span class="o">=</span> <span class="n">comp_config</span><span class="o">.</span><span class="n">OpenWebif</span><span class="o">.</span><span class="n">streamport</span><span class="o">.</span><span class="n">value</span>
		<span class="n">services</span><span class="p">[</span><span class="s2">&quot;host&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">request</span><span class="o">.</span><span class="n">getRequestHostname</span><span class="p">()</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">portnumber</span><span class="si">}</span><span class="s2">&quot;</span>
		<span class="n">services</span><span class="p">[</span><span class="s2">&quot;auth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">auth</span>
		<span class="k">return</span> <span class="n">services</span></div>


<div class="viewcode-block" id="WebController.P_subservices">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_subservices">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_subservices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `subservices` endpoint.</span>

<span class="sd">		.. seealso::</span>

<span class="sd">			https://github.com/oe-alliance/OpenWebif/wiki/OpenWebif-API-documentation#subservices</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="n">getSubServices</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">)</span></div>


<div class="viewcode-block" id="WebController.P_parentcontrollist">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_parentcontrollist">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_parentcontrollist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `parentcontrollist` endpoint.</span>

<span class="sd">		.. seealso::</span>

<span class="sd">			https://github.com/oe-alliance/OpenWebif/wiki/OpenWebif-API-documentation#parentcontrollist</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="n">getParentalControlList</span><span class="p">()</span></div>


<div class="viewcode-block" id="WebController.P_servicelistplayable">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_servicelistplayable">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_servicelistplayable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `servicelistplayable` endpoint.</span>
<span class="sd">		Retrieve list of &#39;playable&#39; bouquets.</span>

<span class="sd">		.. seealso::</span>

<span class="sd">			https://github.com/oe-alliance/OpenWebif/wiki/OpenWebif-API-documentation#servicelistplayable</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">sref</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;sRef&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
		<span class="n">srefplaying</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;sRefPlaying&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">getPlayableServices</span><span class="p">(</span><span class="n">sref</span><span class="p">,</span> <span class="n">srefplaying</span><span class="p">)</span></div>


<div class="viewcode-block" id="WebController.P_serviceplayable">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_serviceplayable">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_serviceplayable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `serviceplayable` endpoint.</span>
<span class="sd">		Check if referenced service is &#39;playable&#39;.</span>

<span class="sd">		.. seealso::</span>

<span class="sd">			https://github.com/oe-alliance/OpenWebif/wiki/OpenWebif-API-documentation#serviceplayable</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">sref</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;sRef&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
		<span class="n">srefplaying</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;sRefPlaying&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">getPlayableService</span><span class="p">(</span><span class="n">sref</span><span class="p">,</span> <span class="n">srefplaying</span><span class="p">)</span></div>


<div class="viewcode-block" id="WebController.P_addlocation">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_addlocation">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_addlocation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `addlocation` endpoint.</span>
<span class="sd">		Add a path to the list of paths where video files are stored.</span>

<span class="sd">		.. seealso::</span>

<span class="sd">			https://github.com/oe-alliance/OpenWebif/wiki/OpenWebif-API-documentation#addlocation</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testMandatoryArguments</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;dirname&quot;</span><span class="p">])</span>
		<span class="k">if</span> <span class="n">res</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">res</span>

		<span class="n">dirname</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;dirname&quot;</span><span class="p">)</span>
		<span class="n">create</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;createFolder&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;1&quot;</span>
		<span class="k">return</span> <span class="n">addLocation</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">create</span><span class="p">)</span></div>


<div class="viewcode-block" id="WebController.P_removelocation">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_removelocation">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_removelocation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `removelocation` endpoint.</span>
<span class="sd">		Remove a path from the list of paths where video files are stored.</span>

<span class="sd">		.. seealso::</span>

<span class="sd">			https://github.com/oe-alliance/OpenWebif/wiki/OpenWebif-API-documentation#removelocation</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testMandatoryArguments</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;dirname&quot;</span><span class="p">])</span>
		<span class="k">if</span> <span class="n">res</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">res</span>

		<span class="n">dirname</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;dirname&quot;</span><span class="p">)</span>
		<span class="n">remove</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;removeFolder&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;1&quot;</span>
		<span class="k">return</span> <span class="n">removeLocation</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">remove</span><span class="p">)</span></div>


<div class="viewcode-block" id="WebController.P_message">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_message">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `message` endpoint.</span>
<span class="sd">		Display a message on the screen attached to enigma2 device.</span>

<span class="sd">		.. seealso::</span>

<span class="sd">			https://github.com/oe-alliance/OpenWebif/wiki/OpenWebif-API-documentation#message</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testMandatoryArguments</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">])</span>
		<span class="k">if</span> <span class="n">res</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">res</span>

		<span class="k">try</span><span class="p">:</span>
			<span class="n">ttype</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="sa">b</span><span class="s2">&quot;type&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
		<span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
			<span class="k">return</span> <span class="p">{</span>
				<span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
				<span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;type </span><span class="si">%s</span><span class="s2"> is not a number&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="sa">b</span><span class="s2">&quot;type&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
			<span class="p">}</span>

		<span class="n">timeout</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
		<span class="k">if</span> <span class="sa">b</span><span class="s2">&quot;timeout&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">timeout</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="sa">b</span><span class="s2">&quot;timeout&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
			<span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
				<span class="k">pass</span>

		<span class="n">text</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">sendMessage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">ttype</span><span class="p">,</span> <span class="n">timeout</span><span class="p">)</span></div>


<div class="viewcode-block" id="WebController.P_messageanswer">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_messageanswer">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_messageanswer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `messageanswer` endpoint.</span>

<span class="sd">		.. seealso::</span>

<span class="sd">			https://github.com/oe-alliance/OpenWebif/wiki/OpenWebif-API-documentation#messageanswer</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="n">getMessageAnswer</span><span class="p">()</span></div>


<div class="viewcode-block" id="WebController.P_movielist">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_movielist">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_movielist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `movielist` endpoint.</span>
<span class="sd">		Retrieve list of movie items. (alternative implementation)</span>

<span class="sd">		.. seealso::</span>

<span class="sd">			https://github.com/oe-alliance/OpenWebif/wiki/OpenWebif-API-documentation#movielist</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="n">getMovieList</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">)</span></div>


	<span class="k">def</span><span class="w"> </span><span class="nf">P_fullmovielist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
		<span class="k">return</span> <span class="n">getAllMovies</span><span class="p">()</span>

<div class="viewcode-block" id="WebController.P_movielisthtml">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_movielisthtml">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_movielisthtml</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `movielisthtml` endpoint.</span>
<span class="sd">		Retrieve list of movie items in HTML format.</span>

<span class="sd">		.. seealso::</span>

<span class="sd">			https://github.com/oe-alliance/OpenWebif/wiki/OpenWebif-API-documentation#movielisthtml</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">request</span><span class="o">.</span><span class="n">setHeader</span><span class="p">(</span><span class="s2">&quot;content-type&quot;</span><span class="p">,</span> <span class="s2">&quot;text/html&quot;</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">getMovieList</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">)</span></div>


<div class="viewcode-block" id="WebController.P_movielistm3u">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_movielistm3u">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_movielistm3u</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `movielistm3u` endpoint.</span>
<span class="sd">		Retrieve list of movie items in M3U format.</span>

<span class="sd">		.. seealso::</span>

<span class="sd">			https://github.com/oe-alliance/OpenWebif/wiki/OpenWebif-API-documentation#movielistm3u</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">request</span><span class="o">.</span><span class="n">setHeader</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="s1">&#39;application/x-mpegurl&#39;</span><span class="p">)</span>
		<span class="n">movielist</span> <span class="o">=</span> <span class="n">getMovieList</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
		<span class="n">movielist</span><span class="p">[</span><span class="s2">&quot;host&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">whoami</span><span class="p">(</span><span class="n">request</span><span class="p">)[</span><span class="s1">&#39;proto&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">://</span><span class="si">{</span><span class="n">request</span><span class="o">.</span><span class="n">getRequestHostname</span><span class="p">()</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">whoami</span><span class="p">(</span><span class="n">request</span><span class="p">)[</span><span class="s1">&#39;port&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
		<span class="k">return</span> <span class="n">movielist</span></div>


<div class="viewcode-block" id="WebController.P_movielistrss">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_movielistrss">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_movielistrss</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `movielistrss` endpoint.</span>
<span class="sd">		Retrieve list of movie items in RSS format.</span>

<span class="sd">		.. seealso::</span>

<span class="sd">			https://github.com/oe-alliance/OpenWebif/wiki/OpenWebif-API-documentation#movielistrss</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">movielist</span> <span class="o">=</span> <span class="n">getMovieList</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
		<span class="n">movielist</span><span class="p">[</span><span class="s2">&quot;host&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">whoami</span><span class="p">(</span><span class="n">request</span><span class="p">)[</span><span class="s1">&#39;proto&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">://</span><span class="si">{</span><span class="n">request</span><span class="o">.</span><span class="n">getRequestHostname</span><span class="p">()</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">whoami</span><span class="p">(</span><span class="n">request</span><span class="p">)[</span><span class="s1">&#39;port&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
		<span class="k">return</span> <span class="n">movielist</span></div>


<div class="viewcode-block" id="WebController.P_moviedelete">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_moviedelete">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_moviedelete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `moviedelete` endpoint.</span>
<span class="sd">		Delete movie file.</span>

<span class="sd">		.. seealso::</span>

<span class="sd">			https://github.com/oe-alliance/OpenWebif/wiki/OpenWebif-API-documentation#moviedelete</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testMandatoryArguments</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;sRef&quot;</span><span class="p">])</span>
		<span class="k">if</span> <span class="n">res</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">res</span>
		<span class="n">sref</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;sRef&quot;</span><span class="p">)</span>
		<span class="n">force</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;force&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
		<span class="k">return</span> <span class="n">removeMovie</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="n">sref</span><span class="p">,</span> <span class="n">force</span><span class="p">)</span></div>


<div class="viewcode-block" id="WebController.P_moviemove">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_moviemove">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_moviemove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `moviemove` endpoint.</span>
<span class="sd">		Move movie file.</span>

<span class="sd">		.. seealso::</span>

<span class="sd">			https://github.com/oe-alliance/OpenWebif/wiki/OpenWebif-API-documentation#moviemove</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testMandatoryArguments</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;sRef&quot;</span><span class="p">])</span>
		<span class="k">if</span> <span class="n">res</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">res</span>
		<span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testMandatoryArguments</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;dirname&quot;</span><span class="p">])</span>
		<span class="k">if</span> <span class="n">res</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">res</span>

		<span class="n">sref</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;sRef&quot;</span><span class="p">)</span>
		<span class="n">dirname</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;dirname&quot;</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">movieAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="n">sref</span><span class="p">,</span> <span class="n">dirname</span><span class="p">,</span> <span class="n">domove</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="WebController.P_moviecopy">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_moviecopy">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_moviecopy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `moviecopy` endpoint.</span>
<span class="sd">		Copy movie file.</span>

<span class="sd">		.. seealso::</span>

<span class="sd">			https://github.com/oe-alliance/OpenWebif/wiki/OpenWebif-API-documentation#moviecopy</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testMandatoryArguments</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;sRef&quot;</span><span class="p">])</span>
		<span class="k">if</span> <span class="n">res</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">res</span>
		<span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testMandatoryArguments</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;dirname&quot;</span><span class="p">])</span>
		<span class="k">if</span> <span class="n">res</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">res</span>

		<span class="n">sref</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;sRef&quot;</span><span class="p">)</span>
		<span class="n">dirname</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;dirname&quot;</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">movieAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="n">sref</span><span class="p">,</span> <span class="n">dirname</span><span class="p">)</span></div>


<div class="viewcode-block" id="WebController.P_movierename">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_movierename">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_movierename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `movierename` endpoint.</span>
<span class="sd">		Rename movie file.</span>

<span class="sd">		.. seealso::</span>

<span class="sd">			https://github.com/oe-alliance/OpenWebif/wiki/OpenWebif-API-documentation#movierename</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testMandatoryArguments</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;sRef&quot;</span><span class="p">])</span>
		<span class="k">if</span> <span class="n">res</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">res</span>
		<span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testMandatoryArguments</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;newname&quot;</span><span class="p">])</span>
		<span class="k">if</span> <span class="n">res</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">res</span>
		<span class="n">sref</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;sRef&quot;</span><span class="p">)</span>
		<span class="n">newname</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;newname&quot;</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">movieAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="n">sref</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="n">newname</span><span class="p">)</span></div>


	<span class="c1"># DEPRECATED use movieinfo</span>
<div class="viewcode-block" id="WebController.P_movietags">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_movietags">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_movietags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `movietags` endpoint.</span>
<span class="sd">		Add/Remove tags to movie file.</span>

<span class="sd">		DEPRECATED -&gt; use movieinfo instead</span>

<span class="sd">		.. seealso::</span>

<span class="sd">			https://github.com/oe-alliance/OpenWebif/wiki/OpenWebif-API-documentation#movietags</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">_add</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;add&quot;</span><span class="p">)</span>
		<span class="n">_del</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;del&quot;</span><span class="p">)</span>
		<span class="n">sref</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;sRef&quot;</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">sref</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">sref</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;sref&quot;</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">getMovieInfo</span><span class="p">(</span><span class="n">sref</span><span class="p">,</span> <span class="n">_add</span><span class="p">,</span> <span class="n">_del</span><span class="p">)</span></div>


<div class="viewcode-block" id="WebController.P_movieinfo">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_movieinfo">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_movieinfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `movie` endpoint.</span>
<span class="sd">		Add/Remove tags to movie file. Multiple tags needs to separate by ,</span>
<span class="sd">		Remame title of movie.</span>
<span class="sd">		Get/set movie cuts.</span>

<span class="sd">		.. seealso::</span>

<span class="sd">			https://github.com/oe-alliance/OpenWebif/wiki/OpenWebif-API-documentation#movieinfo</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">sref</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;sRef&quot;</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">sref</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">sref</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;sref&quot;</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">sref</span><span class="p">:</span>
			<span class="n">addtag</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;addtag&quot;</span><span class="p">)</span>
			<span class="n">deltag</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;deltag&quot;</span><span class="p">)</span>
			<span class="n">title</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;title&quot;</span><span class="p">)</span>
			<span class="n">cuts</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;cuts&quot;</span><span class="p">)</span>
			<span class="n">desc</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;desc&quot;</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">getMovieInfo</span><span class="p">(</span><span class="n">sref</span><span class="p">,</span> <span class="n">addtag</span><span class="p">,</span> <span class="n">deltag</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">cuts</span><span class="p">,</span> <span class="n">desc</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">getMovieInfo</span><span class="p">()</span></div>


<div class="viewcode-block" id="WebController.P_moviedetails">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_moviedetails">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_moviedetails</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `movie` endpoint.</span>

<span class="sd">		.. seealso::</span>

<span class="sd">			https://github.com/oe-alliance/OpenWebif/wiki/OpenWebif-API-documentation#moviedetails</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">sref</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;sRef&quot;</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">sref</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">sref</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;sref&quot;</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">sref</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">getMovieDetails</span><span class="p">(</span><span class="n">sref</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="p">{</span>
				<span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="kc">False</span>
			<span class="p">}</span></div>


	<span class="k">def</span><span class="w"> </span><span class="nf">P_movieresumepoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
		<span class="n">sref</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;sRef&quot;</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">sref</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">sref</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;sref&quot;</span><span class="p">)</span>

		<span class="k">try</span><span class="p">:</span>
			<span class="n">resumepoint</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="sa">b</span><span class="s2">&quot;resumepoint&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="mi">90000</span>  <span class="c1"># in seconds</span>
		<span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">):</span>  <span class="c1"># nosec # noqa: E722</span>
			<span class="n">resumepoint</span> <span class="o">=</span> <span class="kc">None</span>

		<span class="k">if</span> <span class="n">sref</span> <span class="ow">and</span> <span class="n">resumepoint</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">setMovieResumePoint</span><span class="p">(</span><span class="n">sref</span><span class="p">,</span> <span class="n">resumepoint</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="p">{</span>
				<span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="kc">False</span>
			<span class="p">}</span>

<div class="viewcode-block" id="WebController.P_gettags">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_gettags">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_gettags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>  <span class="c1"># a duplicate api ??</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `gettags` endpoint.</span>
<span class="sd">		Get tags of movie file (?).</span>

<span class="sd">		.. seealso::</span>

<span class="sd">			https://github.com/oe-alliance/OpenWebif/wiki/OpenWebif-API-documentation#gettags</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="n">getMovieInfo</span><span class="p">()</span></div>


<span class="c1"># VPS Plugin</span>
<div class="viewcode-block" id="WebController.vpsparams">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.vpsparams">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">vpsparams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		VPS related helper function(?)</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">vpsplugin_enabled</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;vpsplugin_enabled&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;1&quot;</span>
		<span class="n">vpsplugin_overwrite</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;vpsplugin_overwrite&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;1&quot;</span>
		<span class="n">vpsplugin_time</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="k">if</span> <span class="sa">b</span><span class="s2">&quot;vpsplugin_time&quot;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">:</span>
			<span class="n">vpsplugin_time</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="sa">b</span><span class="s2">&quot;vpsplugin_time&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
			<span class="k">if</span> <span class="n">vpsplugin_time</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
				<span class="n">vpsplugin_time</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="c1"># partnerbox:</span>
		<span class="n">vps_pbox</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;vps_pbox&quot;</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">vps_pbox</span><span class="p">:</span>
			<span class="n">vpsplugin_enabled</span> <span class="o">=</span> <span class="kc">None</span>
			<span class="n">vpsplugin_overwrite</span> <span class="o">=</span> <span class="kc">None</span>
			<span class="k">if</span> <span class="s2">&quot;yes_safe&quot;</span> <span class="ow">in</span> <span class="n">vps_pbox</span><span class="p">:</span>
				<span class="n">vpsplugin_enabled</span> <span class="o">=</span> <span class="kc">True</span>
			<span class="k">elif</span> <span class="s2">&quot;yes&quot;</span> <span class="ow">in</span> <span class="n">vps_pbox</span><span class="p">:</span>
				<span class="n">vpsplugin_enabled</span> <span class="o">=</span> <span class="kc">True</span>
				<span class="n">vpsplugin_overwrite</span> <span class="o">=</span> <span class="kc">True</span>
		<span class="k">return</span> <span class="p">{</span>
			<span class="s2">&quot;vpsplugin_time&quot;</span><span class="p">:</span> <span class="n">vpsplugin_time</span><span class="p">,</span>
			<span class="s2">&quot;vpsplugin_overwrite&quot;</span><span class="p">:</span> <span class="n">vpsplugin_overwrite</span><span class="p">,</span>
			<span class="s2">&quot;vpsplugin_enabled&quot;</span><span class="p">:</span> <span class="n">vpsplugin_enabled</span>
		<span class="p">}</span></div>


<div class="viewcode-block" id="WebController.P_vpschannels">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_vpschannels">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_vpschannels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `vpschannels` endpoint.</span>

<span class="sd">		.. note::</span>

<span class="sd">			Not available in *Enigma2 WebInterface API*.</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="n">getVPSChannels</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">)</span></div>


<div class="viewcode-block" id="WebController.P_timerlist">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_timerlist">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_timerlist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `timerlist` endpoint.</span>
<span class="sd">		Retrieve list of timers.</span>

<span class="sd">		.. seealso::</span>

<span class="sd">			https://github.com/oe-alliance/OpenWebif/wiki/OpenWebif-API-documentation#timerlist</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">getTimers</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">)</span>
		<span class="n">ret</span><span class="p">[</span><span class="s2">&quot;locations&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">comp_config</span><span class="o">.</span><span class="n">movielist</span><span class="o">.</span><span class="n">videodirs</span><span class="o">.</span><span class="n">value</span>
		<span class="n">ret</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">comp_config</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">default_path</span><span class="o">.</span><span class="n">value</span>

		<span class="n">tags</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">if</span> <span class="n">isfile</span><span class="p">(</span><span class="n">MOVIETAGFILE</span><span class="p">):</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">MOVIETAGFILE</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
					<span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">fd</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">):</span>
						<span class="k">if</span> <span class="n">tag</span><span class="p">:</span>
							<span class="n">tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tag</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
			<span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
				<span class="k">pass</span>

		<span class="n">ret</span><span class="p">[</span><span class="s2">&quot;tags&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tags</span>
		<span class="k">return</span> <span class="n">ret</span></div>


	<span class="k">def</span><span class="w"> </span><span class="nf">_AddEditTimer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">mode</span><span class="p">):</span>

		<span class="n">returntimer</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;returntimer&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;1&quot;</span>
		<span class="n">disabled</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;disabled&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;1&quot;</span>
		<span class="n">justplay</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;justplay&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;1&quot;</span>
		<span class="n">afterevent</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;afterevent&quot;</span><span class="p">,</span> <span class="s2">&quot;3&quot;</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">afterevent</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span> <span class="s2">&quot;3&quot;</span><span class="p">]:</span>
			<span class="n">afterevent</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">afterevent</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">afterevent</span> <span class="o">=</span> <span class="mi">3</span>

		<span class="n">dirname</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;dirname&quot;</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">dirname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">dirname</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
			<span class="n">dirname</span> <span class="o">=</span> <span class="kc">None</span>

		<span class="n">tags</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">_tags</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;tags&quot;</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">_tags</span><span class="p">:</span>
			<span class="n">tags</span> <span class="o">=</span> <span class="n">_tags</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>

		<span class="n">repeated</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;repeated&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">))</span>

		<span class="n">description</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

		<span class="n">sref</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;sRef&quot;</span><span class="p">)</span>

		<span class="n">eit</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">eventid</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="sa">b</span><span class="s2">&quot;eventid&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
			<span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>  <span class="c1"># nosec # noqa: E722</span>
				<span class="k">return</span> <span class="p">{</span>
					<span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
					<span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;The parameter &#39;eventid&#39; must be a number&quot;</span>
				<span class="p">}</span>
		<span class="k">elif</span> <span class="sa">b</span><span class="s2">&quot;eit&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="sa">b</span><span class="s2">&quot;eit&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
			<span class="n">eit</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="sa">b</span><span class="s2">&quot;eit&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="c1"># This might need further investigation. Do not get exactly the middle, take 20% so we usually expect to get first event.</span>
			<span class="n">queryTime</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="sa">b</span><span class="s2">&quot;begin&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="sa">b</span><span class="s2">&quot;end&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="sa">b</span><span class="s2">&quot;begin&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span> <span class="o">//</span> <span class="mi">5</span>
			<span class="n">epg</span> <span class="o">=</span> <span class="n">EPG</span><span class="p">()</span>
			<span class="n">eventid</span> <span class="o">=</span> <span class="n">epg</span><span class="o">.</span><span class="n">getEventIdByTime</span><span class="p">(</span><span class="n">sref</span><span class="p">,</span> <span class="n">queryTime</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">eventid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
				<span class="n">eit</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">eventid</span><span class="p">)</span>

		<span class="n">always_zap</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;always_zap&quot;</span><span class="p">,</span> <span class="s2">&quot;-1&quot;</span><span class="p">))</span>
		<span class="n">pipzap</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;pipzap&quot;</span><span class="p">,</span> <span class="s2">&quot;-1&quot;</span><span class="p">))</span>
		<span class="n">allow_duplicate</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;allow_duplicate&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;1&quot;</span>

		<span class="n">recordingtype</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;recordingtype&quot;</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">recordingtype</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">recordingtype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;normal&quot;</span><span class="p">,</span> <span class="s2">&quot;descrambled&quot;</span><span class="p">,</span> <span class="s2">&quot;scrambled&quot;</span><span class="p">):</span>
				<span class="n">recordingtype</span> <span class="o">=</span> <span class="kc">None</span>

		<span class="n">marginBefore</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;marginbefore&quot;</span><span class="p">,</span> <span class="s2">&quot;-1&quot;</span><span class="p">))</span>
		<span class="n">marginAfter</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;marginafter&quot;</span><span class="p">,</span> <span class="s2">&quot;-1&quot;</span><span class="p">))</span>
		<span class="n">hasEndTime</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;hasendtime&quot;</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">hasEndTime</span><span class="p">:</span>
			<span class="n">hasEndTime</span> <span class="o">=</span> <span class="n">hasEndTime</span> <span class="o">==</span> <span class="s2">&quot;1&quot;</span>

		<span class="c1"># TODO: merge function addTimer+editTimer+addTimerByEventId in timers.py</span>
		<span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">addTimerByEventId</span><span class="p">(</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span>
				<span class="n">eventid</span><span class="p">,</span>
				<span class="n">sref</span><span class="p">,</span>
				<span class="n">justplay</span><span class="p">,</span>
				<span class="n">dirname</span><span class="p">,</span>
				<span class="n">tags</span><span class="p">,</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">vpsparams</span><span class="p">(</span><span class="n">request</span><span class="p">),</span>
				<span class="n">always_zap</span><span class="p">,</span>
				<span class="n">afterevent</span><span class="p">,</span>
				<span class="n">pipzap</span><span class="p">,</span>
				<span class="n">allow_duplicate</span><span class="p">,</span>
				<span class="n">recordingtype</span><span class="p">,</span>
				<span class="n">marginBefore</span><span class="p">,</span>
				<span class="n">marginAfter</span><span class="p">,</span>
				<span class="n">hasEndTime</span><span class="p">,</span>
				<span class="n">returntimer</span>
			<span class="p">)</span>
		<span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">beginold</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="sa">b</span><span class="s2">&quot;beginOld&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
			<span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>  <span class="c1"># nosec # noqa: E722</span>
				<span class="k">return</span> <span class="p">{</span>
					<span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
					<span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;The parameter &#39;beginOld&#39; must be a number&quot;</span>
				<span class="p">}</span>

			<span class="k">try</span><span class="p">:</span>
				<span class="n">endold</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="sa">b</span><span class="s2">&quot;endOld&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
			<span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>  <span class="c1"># nosec # noqa: E722</span>
				<span class="k">return</span> <span class="p">{</span>
					<span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
					<span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;The parameter &#39;endOld&#39; must be a number&quot;</span>
				<span class="p">}</span>
			<span class="k">return</span> <span class="n">editTimer</span><span class="p">(</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span>
				<span class="n">sref</span><span class="p">,</span>
				<span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;begin&quot;</span><span class="p">),</span>
				<span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;end&quot;</span><span class="p">),</span>
				<span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">),</span>
				<span class="n">description</span><span class="p">,</span>
				<span class="n">disabled</span><span class="p">,</span>
				<span class="n">justplay</span><span class="p">,</span>
				<span class="n">afterevent</span><span class="p">,</span>
				<span class="n">dirname</span><span class="p">,</span>
				<span class="n">tags</span><span class="p">,</span>
				<span class="n">repeated</span><span class="p">,</span>
				<span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;channelOld&quot;</span><span class="p">),</span>
				<span class="n">beginold</span><span class="p">,</span>
				<span class="n">endold</span><span class="p">,</span>
				<span class="n">recordingtype</span><span class="p">,</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">vpsparams</span><span class="p">(</span><span class="n">request</span><span class="p">),</span>
				<span class="n">always_zap</span><span class="p">,</span>
				<span class="n">pipzap</span><span class="p">,</span>
				<span class="n">allow_duplicate</span><span class="p">,</span>
				<span class="n">marginBefore</span><span class="p">,</span>
				<span class="n">marginAfter</span><span class="p">,</span>
				<span class="n">hasEndTime</span><span class="p">,</span>
				<span class="n">returntimer</span>
			<span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">addTimer</span><span class="p">(</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span>
				<span class="n">sref</span><span class="p">,</span>
				<span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;begin&quot;</span><span class="p">),</span>
				<span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;end&quot;</span><span class="p">),</span>
				<span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">),</span>
				<span class="n">description</span><span class="p">,</span>
				<span class="n">disabled</span><span class="p">,</span>
				<span class="n">justplay</span><span class="p">,</span>
				<span class="n">afterevent</span><span class="p">,</span>
				<span class="n">dirname</span><span class="p">,</span>
				<span class="n">tags</span><span class="p">,</span>
				<span class="n">repeated</span><span class="p">,</span>
				<span class="n">recordingtype</span><span class="p">,</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">vpsparams</span><span class="p">(</span><span class="n">request</span><span class="p">),</span>
				<span class="kc">None</span><span class="p">,</span>
				<span class="n">eit</span><span class="p">,</span>
				<span class="n">always_zap</span><span class="p">,</span>
				<span class="n">pipzap</span><span class="p">,</span>
				<span class="n">allow_duplicate</span><span class="p">,</span>
				<span class="n">marginBefore</span><span class="p">,</span>
				<span class="n">marginAfter</span><span class="p">,</span>
				<span class="n">hasEndTime</span><span class="p">,</span>
				<span class="n">returntimer</span>
			<span class="p">)</span>

<div class="viewcode-block" id="WebController.P_timeradd">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_timeradd">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_timeradd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `timeradd` endpoint.</span>
<span class="sd">		Add timer</span>

<span class="sd">		.. seealso::</span>

<span class="sd">			https://github.com/oe-alliance/OpenWebif/wiki/OpenWebif-API-documentation#timeradd</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testMandatoryArguments</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;sRef&quot;</span><span class="p">,</span> <span class="s2">&quot;begin&quot;</span><span class="p">,</span> <span class="s2">&quot;end&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">])</span>
		<span class="k">if</span> <span class="n">res</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">res</span>

		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_AddEditTimer</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span></div>


<div class="viewcode-block" id="WebController.P_timeraddbyeventid">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_timeraddbyeventid">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_timeraddbyeventid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `timeraddbyeventid` endpoint.</span>
<span class="sd">		Add timer by event ID</span>

<span class="sd">		.. seealso::</span>

<span class="sd">			https://github.com/oe-alliance/OpenWebif/wiki/OpenWebif-API-documentation#timeraddbyeventid</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>

<span class="sd">		.. http:get:: /web/timeraddbyeventid</span>
<span class="sd">			:query string sRef: service reference</span>
<span class="sd">			:query int eventid: Event ID</span>
<span class="sd">			:query int justplay: *Just Play* indicator</span>
<span class="sd">			:query string dirname: target path(?)</span>
<span class="sd">			:query string tags: tags to add(?)</span>
<span class="sd">			:query int always_zap: always zap first(?)</span>
<span class="sd">			:query int afterevent: afterevent state</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testMandatoryArguments</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;sRef&quot;</span><span class="p">,</span> <span class="s2">&quot;eventid&quot;</span><span class="p">])</span>
		<span class="k">if</span> <span class="n">res</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">res</span>

		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_AddEditTimer</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span></div>


<div class="viewcode-block" id="WebController.P_timerchange">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_timerchange">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_timerchange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `timerchange` endpoint.</span>
<span class="sd">		Change timer</span>

<span class="sd">		.. seealso::</span>

<span class="sd">			https://github.com/oe-alliance/OpenWebif/wiki/OpenWebif-API-documentation#timerchange</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>

<span class="sd">		.. http:get:: /web/timerchange</span>

<span class="sd">			:query string sRef: service reference</span>
<span class="sd">			:query int begin: begin timestamp</span>
<span class="sd">			:query int end: end timestamp</span>
<span class="sd">			:query string name: name</span>
<span class="sd">			:query string description: description</span>
<span class="sd">			:query string channelOld: old channel(?)</span>
<span class="sd">			:query int beginOld: old begin timestamp(?)</span>
<span class="sd">			:query int endOld: old end timestamp(?)</span>
<span class="sd">			:query int justplay: *Just Play* indicator</span>
<span class="sd">			:query string dirname: target path(?)</span>
<span class="sd">			:query string tags: tags to add(?)</span>
<span class="sd">			:query int always_zap: always zap first(?)</span>
<span class="sd">			:query int disabled: disabled state</span>
<span class="sd">			:query int afterevent: afterevent state</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testMandatoryArguments</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;sRef&quot;</span><span class="p">,</span> <span class="s2">&quot;begin&quot;</span><span class="p">,</span> <span class="s2">&quot;end&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;channelOld&quot;</span><span class="p">,</span> <span class="s2">&quot;beginOld&quot;</span><span class="p">,</span> <span class="s2">&quot;endOld&quot;</span><span class="p">])</span>
		<span class="k">if</span> <span class="n">res</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">res</span>

		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_AddEditTimer</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span></div>


<div class="viewcode-block" id="WebController.P_timertogglestatus">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_timertogglestatus">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_timertogglestatus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `timertogglestatus` endpoint.</span>

<span class="sd">		.. note::</span>

<span class="sd">			Not available in *Enigma2 WebInterface API*.</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testMandatoryArguments</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;sRef&quot;</span><span class="p">,</span> <span class="s2">&quot;begin&quot;</span><span class="p">,</span> <span class="s2">&quot;end&quot;</span><span class="p">])</span>
		<span class="k">if</span> <span class="n">res</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">res</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">begin</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="sa">b</span><span class="s2">&quot;begin&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
		<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>  <span class="c1"># nosec # noqa: E722</span>
			<span class="k">return</span> <span class="p">{</span>
				<span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
				<span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;The parameter &#39;begin&#39; must be a number&quot;</span>
			<span class="p">}</span>

		<span class="k">try</span><span class="p">:</span>
			<span class="n">end</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="sa">b</span><span class="s2">&quot;end&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
		<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>  <span class="c1"># nosec # noqa: E722</span>
			<span class="k">return</span> <span class="p">{</span>
				<span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
				<span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;The parameter &#39;end&#39; must be a number&quot;</span>
			<span class="p">}</span>

		<span class="k">return</span> <span class="n">toggleTimerStatus</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;sRef&quot;</span><span class="p">),</span> <span class="n">begin</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span></div>


<div class="viewcode-block" id="WebController.P_timerdelete">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_timerdelete">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_timerdelete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `timerdelete` endpoint.</span>
<span class="sd">		Delete timer</span>

<span class="sd">		.. seealso::</span>

<span class="sd">			https://github.com/oe-alliance/OpenWebif/wiki/OpenWebif-API-documentation#timerdelete</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testMandatoryArguments</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;sRef&quot;</span><span class="p">,</span> <span class="s2">&quot;begin&quot;</span><span class="p">,</span> <span class="s2">&quot;end&quot;</span><span class="p">])</span>
		<span class="k">if</span> <span class="n">res</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">res</span>

		<span class="k">try</span><span class="p">:</span>
			<span class="n">begin</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="sa">b</span><span class="s2">&quot;begin&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
		<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>  <span class="c1"># nosec # noqa: E722</span>
			<span class="k">return</span> <span class="p">{</span>
				<span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
				<span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;The parameter &#39;begin&#39; must be a number&quot;</span>
			<span class="p">}</span>

		<span class="k">try</span><span class="p">:</span>
			<span class="n">end</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="sa">b</span><span class="s2">&quot;end&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
		<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>  <span class="c1"># nosec # noqa: E722</span>
			<span class="k">return</span> <span class="p">{</span>
				<span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
				<span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;The parameter &#39;end&#39; must be a number&quot;</span>
			<span class="p">}</span>

		<span class="k">try</span><span class="p">:</span>
			<span class="n">eit</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="sa">b</span><span class="s2">&quot;eit&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
		<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>  <span class="c1"># nosec # noqa: E722</span>
			<span class="n">eit</span> <span class="o">=</span> <span class="kc">None</span>

		<span class="k">return</span> <span class="n">removeTimer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;sRef&quot;</span><span class="p">),</span> <span class="n">begin</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">eit</span><span class="p">)</span></div>


<div class="viewcode-block" id="WebController.P_timercleanup">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_timercleanup">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_timercleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `timercleanup` endpoint.</span>

<span class="sd">		.. seealso::</span>

<span class="sd">			https://github.com/oe-alliance/OpenWebif/wiki/OpenWebif-API-documentation#timercleanup</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="n">cleanupTimer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">)</span></div>


<div class="viewcode-block" id="WebController.P_timerlistwrite">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_timerlistwrite">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_timerlistwrite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `timerlistwrite` endpoint.</span>

<span class="sd">		.. seealso::</span>

<span class="sd">			https://github.com/oe-alliance/OpenWebif/wiki/OpenWebif-API-documentation#timerlistwrite</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="n">writeTimerList</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">)</span></div>


<div class="viewcode-block" id="WebController.P_recordnow">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_recordnow">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_recordnow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `recordnow` endpoint.</span>

<span class="sd">		.. seealso::</span>

<span class="sd">			https://github.com/oe-alliance/OpenWebif/wiki/OpenWebif-API-documentation#recordnow</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">infinite</span> <span class="o">=</span> <span class="kc">False</span>
		<span class="k">if</span> <span class="sa">b</span><span class="s2">&quot;undefinitely&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="ow">or</span> <span class="sa">b</span><span class="s2">&quot;infinite&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
			<span class="n">infinite</span> <span class="o">=</span> <span class="kc">True</span>
		<span class="k">return</span> <span class="n">recordNow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="n">infinite</span><span class="p">)</span></div>


<div class="viewcode-block" id="WebController.P_currenttime">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_currenttime">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_currenttime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `currenttime` endpoint.</span>

<span class="sd">		.. seealso::</span>

<span class="sd">			https://github.com/oe-alliance/OpenWebif/wiki/OpenWebif-API-documentation#currenttime</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="n">getCurrentTime</span><span class="p">()</span></div>


<div class="viewcode-block" id="WebController.P_deviceinfo">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_deviceinfo">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_deviceinfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `deviceinfo` endpoint.</span>

<span class="sd">		.. seealso::</span>

<span class="sd">			https://github.com/oe-alliance/OpenWebif/wiki/OpenWebif-API-documentation#deviceinfo</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="n">getInfo</span><span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="n">need_fullinfo</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


	<span class="k">def</span><span class="w"> </span><span class="nf">P_getipv6</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
		<span class="n">request</span><span class="o">.</span><span class="n">setHeader</span><span class="p">(</span><span class="s2">&quot;content-type&quot;</span><span class="p">,</span> <span class="s2">&quot;text/html&quot;</span><span class="p">)</span>
		<span class="n">firstpublic</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
		<span class="n">info</span> <span class="o">=</span> <span class="n">getInfo</span><span class="p">()[</span><span class="s1">&#39;ifaces&#39;</span><span class="p">]</span>
		<span class="k">for</span> <span class="n">iface</span> <span class="ow">in</span> <span class="n">info</span><span class="p">:</span>
			<span class="n">public</span> <span class="o">=</span> <span class="n">iface</span><span class="p">[</span><span class="s1">&#39;firstpublic&#39;</span><span class="p">]</span>
			<span class="k">if</span> <span class="n">public</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
				<span class="n">firstpublic</span> <span class="o">=</span> <span class="n">public</span>
				<span class="k">break</span>

		<span class="k">return</span> <span class="p">{</span>
			<span class="s2">&quot;firstpublic&quot;</span><span class="p">:</span> <span class="n">firstpublic</span>
		<span class="p">}</span>

	<span class="c1"># http://enigma2/api/epgbouquet?bRef=1%3A7%3A1%3A0%3A0%3A0%3A0%3A0%3A0%3A0%3A%20FROM%20BOUQUET%20%22userbouquet.favourites.tv%22%20ORDER%20BY%20bouquet</span>
	<span class="c1"># http://enigma2/web/epgbouquet?bRef=1%3A7%3A1%3A0%3A0%3A0%3A0%3A0%3A0%3A0%3A%20FROM%20BOUQUET%20%22userbouquet.favourites.tv%22%20ORDER%20BY%20bouquet</span>
	<span class="c1"># TODO: this is _woefully_ inefficient</span>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_epgbouquet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
		<span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testMandatoryArguments</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;bRef&quot;</span><span class="p">])</span>
		<span class="k">if</span> <span class="n">res</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">res</span>

		<span class="n">begintime</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
		<span class="k">if</span> <span class="sa">b</span><span class="s2">&quot;time&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">begintime</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="sa">b</span><span class="s2">&quot;time&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
			<span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
				<span class="k">pass</span>

		<span class="n">endtime</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="k">if</span> <span class="sa">b</span><span class="s2">&quot;endTime&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">endtime</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="sa">b</span><span class="s2">&quot;endTime&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
			<span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
				<span class="k">pass</span>

		<span class="k">return</span> <span class="n">getBouquetEpg</span><span class="p">(</span><span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;bRef&quot;</span><span class="p">),</span> <span class="n">begintime</span><span class="p">,</span> <span class="n">endtime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">isJson</span><span class="p">)</span>

	<span class="c1"># http://enigma2/api/epgmulti?bRef=1%3A7%3A1%3A0%3A0%3A0%3A0%3A0%3A0%3A0%3A%20FROM%20BOUQUET%20&quot;userbouquet.favourites.tv&quot;%20ORDER%20BY%20bouquet</span>
	<span class="c1"># http://enigma2/web/epgmulti?bRef=1%3A7%3A1%3A0%3A0%3A0%3A0%3A0%3A0%3A0%3A%20FROM%20BOUQUET%20&quot;userbouquet.favourites.tv&quot;%20ORDER%20BY%20bouquet</span>
	<span class="c1"># TODO: check if originally dupe of `P_epgbouquet`</span>
<div class="viewcode-block" id="WebController.P_epgmulti">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_epgmulti">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_epgmulti</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `epgmulti` endpoint.</span>

<span class="sd">		.. note::</span>

<span class="sd">			Not available in *Enigma2 WebInterface API*.</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testMandatoryArguments</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;bRef&quot;</span><span class="p">])</span>
		<span class="k">if</span> <span class="n">res</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">res</span>

		<span class="n">begintime</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
		<span class="k">if</span> <span class="sa">b</span><span class="s2">&quot;time&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">begintime</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="sa">b</span><span class="s2">&quot;time&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
			<span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
				<span class="k">pass</span>

		<span class="n">endtime</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
		<span class="k">if</span> <span class="sa">b</span><span class="s2">&quot;endTime&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">endtime</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="sa">b</span><span class="s2">&quot;endTime&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
			<span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
				<span class="k">pass</span>
		<span class="k">return</span> <span class="n">getBouquetEpg</span><span class="p">(</span><span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;bRef&quot;</span><span class="p">),</span> <span class="n">begintime</span><span class="p">,</span> <span class="n">endtime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">isJson</span><span class="p">)</span></div>


<div class="viewcode-block" id="WebController.P_epgxmltv">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_epgxmltv">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_epgxmltv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `epgxmltv` endpoint.</span>

<span class="sd">		.. note::</span>

<span class="sd">			Not available in *Enigma2 WebInterface API*.</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">			bRef: mandatory, method uses epgmulti</span>
<span class="sd">			lang: mandatory, needed for xmltv and Enigma2 has no parameter for epg language</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testMandatoryArguments</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;bRef&quot;</span><span class="p">,</span> <span class="s2">&quot;lang&quot;</span><span class="p">])</span>
		<span class="k">if</span> <span class="n">res</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">res</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">P_epgmulti</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
		<span class="n">bref</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;bRef&quot;</span><span class="p">)</span>
		<span class="n">ret</span><span class="p">[</span><span class="s2">&quot;services&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">getServices</span><span class="p">(</span><span class="n">bref</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">)[</span><span class="s2">&quot;services&quot;</span><span class="p">]</span>
		<span class="n">ret</span><span class="p">[</span><span class="s2">&quot;lang&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;lang&quot;</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">ret</span></div>


	<span class="c1"># http://enigma2/api/epgnow?bRef=1%3A7%3A1%3A0%3A0%3A0%3A0%3A0%3A0%3A0%3A%20FROM%20BOUQUET%20&quot;userbouquet.favourites.tv&quot;%20ORDER%20BY%20bouquet</span>
	<span class="c1"># http://enigma2/web/epgnow?bRef=1%3A7%3A1%3A0%3A0%3A0%3A0%3A0%3A0%3A0%3A%20FROM%20BOUQUET%20&quot;userbouquet.favourites.tv&quot;%20ORDER%20BY%20bouquet</span>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_epgnow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">epgnownext</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">EPG</span><span class="o">.</span><span class="n">NOW</span><span class="p">)</span>

	<span class="c1"># http://enigma2/api/epgnext?bRef=1%3A7%3A1%3A0%3A0%3A0%3A0%3A0%3A0%3A0%3A%20FROM%20BOUQUET%20&quot;userbouquet.favourites.tv&quot;%20ORDER%20BY%20bouquet</span>
	<span class="c1"># http://enigma2/web/epgnext?bRef=1%3A7%3A1%3A0%3A0%3A0%3A0%3A0%3A0%3A0%3A%20FROM%20BOUQUET%20&quot;userbouquet.favourites.tv&quot;%20ORDER%20BY%20bouquet</span>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_epgnext</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">epgnownext</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">EPG</span><span class="o">.</span><span class="n">NEXT</span><span class="p">)</span>

	<span class="c1"># http://enigma2/api/epgnownext?bRef=1%3A7%3A1%3A0%3A0%3A0%3A0%3A0%3A0%3A0%3A%20FROM%20BOUQUET%20&quot;userbouquet.favourites.tv&quot;%20ORDER%20BY%20bouquet</span>
	<span class="c1"># http://enigma2/web/epgnownext?bRef=1%3A7%3A1%3A0%3A0%3A0%3A0%3A0%3A0%3A0%3A%20FROM%20BOUQUET%20&quot;userbouquet.favourites.tv&quot;%20ORDER%20BY%20bouquet</span>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_epgnownext</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">epgnownext</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">EPG</span><span class="o">.</span><span class="n">NOW_NEXT</span><span class="p">)</span>

	<span class="k">def</span><span class="w"> </span><span class="nf">epgnownext</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">nowornext</span><span class="p">):</span>
		<span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testMandatoryArguments</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;bRef&quot;</span><span class="p">])</span>
		<span class="k">if</span> <span class="n">res</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">res</span>
		<span class="n">bref</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;bRef&quot;</span><span class="p">)</span>
		<span class="n">showisplayable</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;showIsPlayable&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
		<span class="n">showstreamrelay</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;showstreamrelay&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">False</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">getBouquetNowNextEpg</span><span class="p">(</span><span class="n">bref</span><span class="p">,</span> <span class="n">nowornext</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">isJson</span><span class="p">,</span> <span class="n">showisplayable</span><span class="o">=</span><span class="n">showisplayable</span><span class="p">,</span> <span class="n">showstreamrelay</span><span class="o">=</span><span class="n">showstreamrelay</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">nowornext</span> <span class="o">==</span> <span class="n">EPG</span><span class="o">.</span><span class="n">NOW_NEXT</span><span class="p">:</span>
			<span class="n">info</span> <span class="o">=</span> <span class="n">getCurrentService</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">)</span>
			<span class="n">ret</span><span class="p">[</span><span class="s2">&quot;info&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">info</span>
		<span class="k">return</span> <span class="n">ret</span>

	<span class="k">def</span><span class="w"> </span><span class="nf">P_epgmultichannelnownext</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
		<span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testMandatoryArguments</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;sRefs&quot;</span><span class="p">])</span>
		<span class="k">if</span> <span class="n">res</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">res</span>

		<span class="n">srefs</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;sRefs&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">getMultiChannelNowNextEpg</span><span class="p">(</span><span class="n">srefs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">isJson</span><span class="p">)</span>

		<span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>  <span class="c1"># fixed Jun&#39;22 (seems to have been broken for quite a while)</span>

	<span class="c1"># http://enigma2/api/epgsearch?search=test</span>
	<span class="c1"># http://enigma2/web/epgsearch?search=test</span>
<div class="viewcode-block" id="WebController.P_epgsearch">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_epgsearch">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_epgsearch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		EPG event search and lookup handler.</span>

<span class="sd">		.. note::</span>

<span class="sd">			One may use</span>
<span class="sd">			:py:func:`controllers.events.EventsController.search` for</span>
<span class="sd">			searching events.</span>

<span class="sd">		.. seealso::</span>

<span class="sd">			https://github.com/oe-alliance/OpenWebif/wiki/OpenWebif-API-documentation#epgsearch</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">search</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;search&quot;</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">search</span><span class="p">:</span>
			<span class="n">endtime</span> <span class="o">=</span> <span class="kc">None</span>
			<span class="k">if</span> <span class="sa">b</span><span class="s2">&quot;endtime&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="n">endtime</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="sa">b</span><span class="s2">&quot;endtime&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
				<span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
					<span class="k">pass</span>
			<span class="n">fulldesc</span> <span class="o">=</span> <span class="kc">False</span>
			<span class="k">if</span> <span class="sa">b</span><span class="s2">&quot;full&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
				<span class="n">fulldesc</span> <span class="o">=</span> <span class="kc">True</span>
			<span class="k">return</span> <span class="n">getSearchEpg</span><span class="p">(</span><span class="n">search</span><span class="p">,</span> <span class="n">endtime</span><span class="p">,</span> <span class="n">fulldesc</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">isJson</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testMandatoryArguments</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;eventid&quot;</span><span class="p">])</span>
			<span class="k">if</span> <span class="n">res</span><span class="p">:</span>
				<span class="k">return</span> <span class="n">res</span>
			<span class="n">sref</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;sRef&quot;</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">sref</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
				<span class="n">sref</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;sref&quot;</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">sref</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
				<span class="k">return</span> <span class="p">{</span>
					<span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
					<span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;The parameter &#39;</span><span class="si">%s</span><span class="s2">&#39; can&#39;t be empty&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="s2">&quot;sRef,sref&quot;</span>
				<span class="p">}</span>
			<span class="n">item_id</span> <span class="o">=</span> <span class="mi">0</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">item_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="sa">b</span><span class="s2">&quot;eventid&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
			<span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
				<span class="k">pass</span>
			<span class="k">return</span> <span class="n">getEvent</span><span class="p">(</span><span class="n">sref</span><span class="p">,</span> <span class="n">item_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">isJson</span><span class="p">)</span></div>


	<span class="c1"># http://enigma2/api/epgsearchrss?search=test</span>
	<span class="c1"># http://enigma2/web/epgsearchrss?search=test</span>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_epgsearchrss</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
		<span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testMandatoryArguments</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;search&quot;</span><span class="p">])</span>
		<span class="k">if</span> <span class="n">res</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">res</span>

		<span class="n">search</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;search&quot;</span><span class="p">)</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">getSearchEpg</span><span class="p">(</span><span class="n">search</span><span class="p">)</span>
		<span class="n">ret</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;EPG Search &#39;</span><span class="si">{</span><span class="n">search</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
		<span class="n">ret</span><span class="p">[</span><span class="s2">&quot;generator&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;OpenWebif&quot;</span>
		<span class="n">ret</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">ret</span><span class="p">[</span><span class="s1">&#39;events&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2"> result for &#39;</span><span class="si">{</span><span class="n">search</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
		<span class="k">return</span> <span class="n">ret</span>

	<span class="c1"># http://enigma2/api/epgservice?sRef=1%3A0%3A19%3A1B1F%3A802%3A2%3A11A0000%3A0%3A0%3A0%3A</span>
	<span class="c1"># http://enigma2/web/epgservice?sRef=1%3A0%3A19%3A1B1F%3A802%3A2%3A11A0000%3A0%3A0%3A0%3A</span>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_epgservice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
		<span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testMandatoryArguments</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;sRef&quot;</span><span class="p">])</span>
		<span class="k">if</span> <span class="n">res</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">res</span>

		<span class="n">begintime</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
		<span class="k">if</span> <span class="sa">b</span><span class="s2">&quot;time&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">begintime</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="sa">b</span><span class="s2">&quot;time&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
			<span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
				<span class="k">pass</span>

		<span class="n">endtime</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
		<span class="k">if</span> <span class="sa">b</span><span class="s2">&quot;endTime&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">endtime</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="sa">b</span><span class="s2">&quot;endTime&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
			<span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
				<span class="k">pass</span>
		<span class="k">return</span> <span class="n">getChannelEpg</span><span class="p">(</span><span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;sRef&quot;</span><span class="p">),</span> <span class="n">begintime</span><span class="p">,</span> <span class="n">endtime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">isJson</span><span class="p">)</span>

	<span class="c1"># http://enigma2/api/epgservicenow?sRef=1%3A0%3A19%3A1B1F%3A802%3A2%3A11A0000%3A0%3A0%3A0%3A</span>
	<span class="c1"># http://enigma2/web/epgservicenow?sRef=1%3A0%3A19%3A1B1F%3A802%3A2%3A11A0000%3A0%3A0%3A0%3A</span>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_epgservicenow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
		<span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testMandatoryArguments</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;sRef&quot;</span><span class="p">])</span>
		<span class="k">if</span> <span class="n">res</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">res</span>
		<span class="k">return</span> <span class="n">getNowNextEpg</span><span class="p">(</span><span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;sRef&quot;</span><span class="p">),</span> <span class="n">EPG</span><span class="o">.</span><span class="n">NOW</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">isJson</span><span class="p">)</span>

	<span class="c1"># http://enigma2/api/epgservicenext?sRef=1%3A0%3A19%3A1B1F%3A802%3A2%3A11A0000%3A0%3A0%3A0%3A</span>
	<span class="c1"># http://enigma2/web/epgservicenext?sRef=1%3A0%3A19%3A1B1F%3A802%3A2%3A11A0000%3A0%3A0%3A0%3A</span>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_epgservicenext</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
		<span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testMandatoryArguments</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;sRef&quot;</span><span class="p">])</span>
		<span class="k">if</span> <span class="n">res</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">res</span>
		<span class="k">return</span> <span class="n">getNowNextEpg</span><span class="p">(</span><span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;sRef&quot;</span><span class="p">),</span> <span class="n">EPG</span><span class="o">.</span><span class="n">NEXT</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">isJson</span><span class="p">)</span>

	<span class="k">def</span><span class="w"> </span><span class="nf">P_epgservicenownext</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
		<span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testMandatoryArguments</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;sRef&quot;</span><span class="p">])</span>
		<span class="k">if</span> <span class="n">res</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">res</span>

		<span class="n">eventnow</span> <span class="o">=</span> <span class="n">getNowNextEpg</span><span class="p">(</span><span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;sRef&quot;</span><span class="p">),</span> <span class="n">EPG</span><span class="o">.</span><span class="n">NOW</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">isJson</span><span class="p">)</span>
		<span class="n">eventnext</span> <span class="o">=</span> <span class="n">getNowNextEpg</span><span class="p">(</span><span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;sRef&quot;</span><span class="p">),</span> <span class="n">EPG</span><span class="o">.</span><span class="n">NEXT</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">isJson</span><span class="p">)</span>
		<span class="n">eventnow</span> <span class="o">=</span> <span class="n">eventnow</span><span class="p">[</span><span class="s2">&quot;events&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">eventnow</span><span class="p">[</span><span class="s2">&quot;events&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="p">{}</span>
		<span class="n">eventnext</span> <span class="o">=</span> <span class="n">eventnext</span><span class="p">[</span><span class="s2">&quot;events&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">eventnext</span><span class="p">[</span><span class="s2">&quot;events&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="p">{}</span>
		<span class="k">return</span> <span class="p">{</span><span class="s2">&quot;events&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">eventnow</span><span class="p">,</span> <span class="n">eventnext</span><span class="p">]}</span>

	<span class="c1"># http://enigma2/api/epgsimilar?sRef=1%3A0%3A19%3A1B1F%3A802%3A2%3A11A0000%3A0%3A0%3A0%3A&amp;eventid=32645</span>
	<span class="c1"># http://enigma2/web/epgsimilar?sRef=1%3A0%3A19%3A1B1F%3A802%3A2%3A11A0000%3A0%3A0%3A0%3A&amp;eventid=32645</span>

	<span class="k">def</span><span class="w"> </span><span class="nf">P_epgsimilar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
		<span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testMandatoryArguments</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;sRef&quot;</span><span class="p">,</span> <span class="s2">&quot;eventid&quot;</span><span class="p">])</span>
		<span class="k">if</span> <span class="n">res</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">res</span>

		<span class="k">try</span><span class="p">:</span>
			<span class="n">eventid</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="sa">b</span><span class="s2">&quot;eventid&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
		<span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
			<span class="k">return</span> <span class="p">{</span>
				<span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
				<span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;The parameter &#39;eventid&#39; must be a number&quot;</span>
			<span class="p">}</span>
		<span class="k">return</span> <span class="n">getSimilarEpg</span><span class="p">(</span><span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;sRef&quot;</span><span class="p">),</span> <span class="n">eventid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">isJson</span><span class="p">)[</span><span class="s1">&#39;events&#39;</span><span class="p">]</span>

	<span class="c1"># http://enigma2/api/event?idev=32695&amp;sref=1%3A0%3A19%3A1B1F%3A802%3A2%3A11A0000%3A0%3A0%3A0%3A</span>
	<span class="c1"># (/web/event returns a 404 in both `classic` and `modern` interfaces</span>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
		<span class="n">sref</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;sRef&quot;</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">sref</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">sref</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;sref&quot;</span><span class="p">)</span>

		<span class="n">event</span> <span class="o">=</span> <span class="n">getEvent</span><span class="p">(</span><span class="n">sref</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="sa">b</span><span class="s2">&quot;idev&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">isJson</span><span class="p">)</span>

		<span class="k">if</span> <span class="n">event</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="c1"># TODO: this shouldn&#39;t really be part of an event&#39;s data</span>
			<span class="n">event</span><span class="p">[</span><span class="s1">&#39;event&#39;</span><span class="p">][</span><span class="s1">&#39;recording_margin_before&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">comp_config</span><span class="o">.</span><span class="n">recording</span><span class="o">.</span><span class="n">margin_before</span><span class="o">.</span><span class="n">value</span>
			<span class="n">event</span><span class="p">[</span><span class="s1">&#39;event&#39;</span><span class="p">][</span><span class="s1">&#39;recording_margin_after&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">comp_config</span><span class="o">.</span><span class="n">recording</span><span class="o">.</span><span class="n">margin_after</span><span class="o">.</span><span class="n">value</span>
			<span class="k">return</span> <span class="n">event</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="kc">None</span>

	<span class="c1"># http://enigma2/api/getcurrent</span>
	<span class="c1"># http://enigma2/web/getcurrent</span>
<div class="viewcode-block" id="WebController.P_getcurrent">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_getcurrent">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_getcurrent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `getcurrent` endpoint.</span>

<span class="sd">		.. seealso::</span>

<span class="sd">			https://github.com/oe-alliance/OpenWebif/wiki/OpenWebif-API-documentation#getcurrent</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>


<span class="sd">		.. http:get:: /web/getcurrent</span>

<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">info</span> <span class="o">=</span> <span class="n">getCurrentService</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">)</span>
		<span class="n">eventnow</span> <span class="o">=</span> <span class="n">getNowNextEpg</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;ref&quot;</span><span class="p">],</span> <span class="n">EPG</span><span class="o">.</span><span class="n">NOW</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">isJson</span><span class="p">)</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">eventnow</span><span class="p">[</span><span class="s2">&quot;events&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
			<span class="n">eventnow</span> <span class="o">=</span> <span class="n">eventnow</span><span class="p">[</span><span class="s2">&quot;events&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
			<span class="n">eventnow</span><span class="p">[</span><span class="s2">&quot;provider&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s2">&quot;provider&quot;</span><span class="p">]</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">eventnow</span> <span class="o">=</span> <span class="p">{</span>
				<span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
				<span class="s2">&quot;begin_timestamp&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
				<span class="s2">&quot;duration_sec&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
				<span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
				<span class="s2">&quot;shortdesc&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
				<span class="s2">&quot;longdesc&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
				<span class="s2">&quot;sref&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
				<span class="s2">&quot;sname&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
				<span class="s2">&quot;now_timestamp&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
				<span class="s2">&quot;remaining&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
				<span class="s2">&quot;provider&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
				<span class="s2">&quot;genre&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
				<span class="s2">&quot;genreid&quot;</span><span class="p">:</span> <span class="mi">0</span>
			<span class="p">}</span>
		<span class="n">eventnext</span> <span class="o">=</span> <span class="n">getNowNextEpg</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;ref&quot;</span><span class="p">],</span> <span class="n">EPG</span><span class="o">.</span><span class="n">NEXT</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">isJson</span><span class="p">)</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">eventnext</span><span class="p">[</span><span class="s2">&quot;events&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
			<span class="n">eventnext</span> <span class="o">=</span> <span class="n">eventnext</span><span class="p">[</span><span class="s2">&quot;events&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
			<span class="n">eventnext</span><span class="p">[</span><span class="s2">&quot;provider&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s2">&quot;provider&quot;</span><span class="p">]</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">eventnext</span> <span class="o">=</span> <span class="p">{</span>
				<span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
				<span class="s2">&quot;begin_timestamp&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
				<span class="s2">&quot;duration_sec&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
				<span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
				<span class="s2">&quot;shortdesc&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
				<span class="s2">&quot;longdesc&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
				<span class="s2">&quot;sref&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
				<span class="s2">&quot;sname&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
				<span class="s2">&quot;now_timestamp&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
				<span class="s2">&quot;remaining&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
				<span class="s2">&quot;provider&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
				<span class="s2">&quot;genre&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
				<span class="s2">&quot;genreid&quot;</span><span class="p">:</span> <span class="mi">0</span>
			<span class="p">}</span>
		<span class="c1"># replace EPG NOW with Movie info</span>
		<span class="n">mnow</span> <span class="o">=</span> <span class="n">eventnow</span>
		<span class="k">if</span> <span class="n">info</span><span class="p">[</span><span class="s2">&quot;ref&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;1:0:0:0:0:0:0:0:0:0:/&#39;</span><span class="p">):</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">mnow</span><span class="p">[</span><span class="s2">&quot;sref&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s2">&quot;ref&quot;</span><span class="p">]</span>
				<span class="n">service</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">nav</span><span class="o">.</span><span class="n">getCurrentService</span><span class="p">()</span>
				<span class="n">minfo</span> <span class="o">=</span> <span class="n">service</span> <span class="ow">and</span> <span class="n">service</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
				<span class="n">movie</span> <span class="o">=</span> <span class="n">minfo</span> <span class="ow">and</span> <span class="n">minfo</span><span class="o">.</span><span class="n">getEvent</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
				<span class="k">if</span> <span class="n">movie</span> <span class="ow">and</span> <span class="n">minfo</span><span class="p">:</span>
					<span class="n">mnow</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">movie</span><span class="o">.</span><span class="n">getEventName</span><span class="p">()</span>
					<span class="n">mnow</span><span class="p">[</span><span class="s2">&quot;shortdesc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">movie</span><span class="o">.</span><span class="n">getShortDescription</span><span class="p">()</span>
					<span class="n">mnow</span><span class="p">[</span><span class="s2">&quot;longdesc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">movie</span><span class="o">.</span><span class="n">getExtendedDescription</span><span class="p">()</span>
					<span class="n">mnow</span><span class="p">[</span><span class="s2">&quot;begin_timestamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">movie</span><span class="o">.</span><span class="n">getBeginTime</span><span class="p">()</span>
					<span class="n">mnow</span><span class="p">[</span><span class="s2">&quot;duration_sec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">movie</span><span class="o">.</span><span class="n">getDuration</span><span class="p">()</span>
					<span class="n">mnow</span><span class="p">[</span><span class="s2">&quot;remaining&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">movie</span><span class="o">.</span><span class="n">getDuration</span><span class="p">()</span>
					<span class="n">mnow</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">movie</span><span class="o">.</span><span class="n">getEventId</span><span class="p">()</span>
			<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>  <span class="c1"># nosec # noqa: E722</span>
				<span class="n">mnow</span> <span class="o">=</span> <span class="n">eventnow</span>
		<span class="k">elif</span> <span class="n">mnow</span><span class="p">[</span><span class="s2">&quot;sref&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
			<span class="n">serviceref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">nav</span><span class="o">.</span><span class="n">getCurrentlyPlayingServiceReference</span><span class="p">()</span>
			<span class="k">if</span> <span class="n">serviceref</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="k">if</span> <span class="n">serviceref</span><span class="o">.</span><span class="n">toString</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;4097:0:0:0:0:0:0:0:0:0:/&#39;</span><span class="p">):</span>
						<span class="kn">from</span><span class="w"> </span><span class="nn">enigma</span><span class="w"> </span><span class="kn">import</span> <span class="n">eServiceCenter</span>
						<span class="n">servicehandler</span> <span class="o">=</span> <span class="n">eServiceCenter</span><span class="o">.</span><span class="n">getInstance</span><span class="p">()</span>
						<span class="n">sinfo</span> <span class="o">=</span> <span class="n">servicehandler</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">serviceref</span><span class="p">)</span>
						<span class="k">if</span> <span class="n">sinfo</span><span class="p">:</span>
							<span class="n">mnow</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sinfo</span><span class="o">.</span><span class="n">getName</span><span class="p">(</span><span class="n">serviceref</span><span class="p">)</span>
						<span class="n">servicepath</span> <span class="o">=</span> <span class="n">serviceref</span> <span class="ow">and</span> <span class="n">serviceref</span><span class="o">.</span><span class="n">getPath</span><span class="p">()</span>
						<span class="k">if</span> <span class="n">servicepath</span> <span class="ow">and</span> <span class="n">servicepath</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">):</span>
							<span class="n">mnow</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">servicepath</span>
							<span class="n">mnow</span><span class="p">[</span><span class="s2">&quot;sref&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">serviceref</span><span class="o">.</span><span class="n">toString</span><span class="p">()</span>
				<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>  <span class="c1"># nosec</span>
					<span class="k">pass</span>
		<span class="k">return</span> <span class="p">{</span>
			<span class="s2">&quot;info&quot;</span><span class="p">:</span> <span class="n">info</span><span class="p">,</span>
			<span class="s2">&quot;now&quot;</span><span class="p">:</span> <span class="n">mnow</span><span class="p">,</span>
			<span class="s2">&quot;next&quot;</span><span class="p">:</span> <span class="n">eventnext</span>
		<span class="p">}</span></div>


<div class="viewcode-block" id="WebController.P_getpid">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_getpid">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_getpid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `getpid` endpoint.</span>

<span class="sd">		.. seealso::</span>

<span class="sd">			https://github.com/oe-alliance/OpenWebif/wiki/OpenWebif-API-documentation#getpid</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">request</span><span class="o">.</span><span class="n">setHeader</span><span class="p">(</span><span class="s2">&quot;content-type&quot;</span><span class="p">,</span> <span class="s2">&quot;text/html&quot;</span><span class="p">)</span>
		<span class="n">info</span> <span class="o">=</span> <span class="n">getCurrentService</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">)</span>
		<span class="k">return</span> <span class="p">{</span>
			<span class="s2">&quot;ppid&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;pmtpid&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">x</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
			<span class="s2">&quot;vpid&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;vpid&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">x</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
			<span class="s2">&quot;apid&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;apid&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">x</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
			<span class="s2">&quot;host&quot;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">getRequestHostname</span><span class="p">()</span>
		<span class="p">}</span></div>


	<span class="k">def</span><span class="w"> </span><span class="nf">P_collapsemenu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
		<span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testMandatoryArguments</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
		<span class="k">if</span> <span class="n">res</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">res</span>
		<span class="k">return</span> <span class="n">addCollapsedMenu</span><span class="p">(</span><span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">))</span>

	<span class="k">def</span><span class="w"> </span><span class="nf">P_expandmenu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
		<span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testMandatoryArguments</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
		<span class="k">if</span> <span class="n">res</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">res</span>
		<span class="k">return</span> <span class="n">removeCollapsedMenu</span><span class="p">(</span><span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">))</span>

<div class="viewcode-block" id="WebController.P_streamm3u">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_streamm3u">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_streamm3u</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `streamm3u` endpoint.</span>

<span class="sd">		.. seealso::</span>

<span class="sd">			https://github.com/oe-alliance/OpenWebif/wiki/OpenWebif-API-documentation#streamm3u</span>

<span class="sd">		.. note::</span>

<span class="sd">			Parameters Not available in *Enigma2 WebInterface API*.</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>

<span class="sd">		.. http:get:: /web/stream.m3u</span>

<span class="sd">			:query string ref: service reference</span>
<span class="sd">			:query string name: service name</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">isCustom</span> <span class="o">=</span> <span class="kc">True</span>
		<span class="k">if</span> <span class="n">comp_config</span><span class="o">.</span><span class="n">OpenWebif</span><span class="o">.</span><span class="n">webcache</span><span class="o">.</span><span class="n">zapstream</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
			<span class="n">ref</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;ref&quot;</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">ref</span><span class="p">:</span>
				<span class="n">name</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
				<span class="n">zapService</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">getStream</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="s2">&quot;stream.m3u&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="WebController.P_tsm3u">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_tsm3u">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_tsm3u</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `tsm3u` endpoint.</span>

<span class="sd">		.. seealso::</span>

<span class="sd">			https://github.com/oe-alliance/OpenWebif/wiki/OpenWebif-API-documentation#tsm3u</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>

<span class="sd">		.. http:get:: /web/ts.m3u</span>
<span class="sd">			:query string file: filename of the stream</span>

<span class="sd">		&quot;&quot;&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">isCustom</span> <span class="o">=</span> <span class="kc">True</span>
		<span class="k">return</span> <span class="n">getTS</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span></div>


	<span class="k">def</span><span class="w"> </span><span class="nf">P_videom3u</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">isCustom</span> <span class="o">=</span> <span class="kc">True</span>
		<span class="k">return</span> <span class="n">getStream</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="s2">&quot;video.m3u&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="WebController.P_streamcurrentm3u">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_streamcurrentm3u">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_streamcurrentm3u</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `streamcurrentm3u` endpoint.</span>

<span class="sd">		.. seealso::</span>

<span class="sd">			https://github.com/oe-alliance/OpenWebif/wiki/OpenWebif-API-documentation#streamcurrentm3u</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>

<span class="sd">		.. http:get:: /web/streamcurrent.m3u</span>

<span class="sd">		&quot;&quot;&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">isCustom</span> <span class="o">=</span> <span class="kc">True</span>
		<span class="k">return</span> <span class="n">getStream</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="s2">&quot;streamcurrent.m3u&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="WebController.P_streamsubservices">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_streamsubservices">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_streamsubservices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `streamsubservices` endpoint.</span>

<span class="sd">		.. seealso::</span>

<span class="sd">			https://github.com/oe-alliance/OpenWebif/wiki/OpenWebif-API-documentation#streamsubservices</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>

<span class="sd">		.. http:get:: /web/streamsubservices</span>

<span class="sd">			:query string sRef: service reference</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="n">getStreamSubservices</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span></div>


<div class="viewcode-block" id="WebController.P_servicelistreload">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_servicelistreload">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_servicelistreload</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Reload service lists, transponders, parental control black-/white lists</span>
<span class="sd">		or/and lamedb.</span>

<span class="sd">		.. seealso::</span>

<span class="sd">			https://github.com/oe-alliance/OpenWebif/wiki/OpenWebif-API-documentation#servicelistreload</span>


<span class="sd">		.. http:get:: /web/servicelistreload</span>

<span class="sd">			:query string mode: [0=both, 1=lamedb only, 2=userbouqets only, 3=transponders, 4=parentalcontrol white-/blacklist]</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testMandatoryArguments</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;mode&quot;</span><span class="p">])</span>
		<span class="k">if</span> <span class="n">res</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">res</span>
		<span class="n">mode</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;mode&quot;</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">reloadServicesLists</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span></div>


<div class="viewcode-block" id="WebController.P_tvbrowser">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_tvbrowser">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_tvbrowser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `tvbrowser` endpoint.</span>

<span class="sd">		.. seealso::</span>

<span class="sd">			https://github.com/oe-alliance/OpenWebif/wiki/OpenWebif-API-documentation#tvbrowser</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="n">tvbrowser</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span></div>


<div class="viewcode-block" id="WebController.P_saveconfig">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_saveconfig">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_saveconfig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `saveconfig` endpoint.</span>

<span class="sd">		.. note::</span>

<span class="sd">			Not available in *Enigma2 WebInterface API*.</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>

<span class="sd">		.. http:post:: /web/saveconfig</span>

<span class="sd">			:query string key: configuration key</span>
<span class="sd">			:query string value: configuration value</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="sa">b</span><span class="s1">&#39;POST&#39;</span><span class="p">:</span>
			<span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testMandatoryArguments</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;key&quot;</span><span class="p">])</span>
			<span class="k">if</span> <span class="n">res</span><span class="p">:</span>
				<span class="k">return</span> <span class="n">res</span>
			<span class="n">value</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">value</span><span class="p">:</span>
				<span class="n">key</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;key&quot;</span><span class="p">)</span>
				<span class="k">return</span> <span class="n">saveConfig</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
		<span class="k">return</span> <span class="p">{</span><span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span></div>


	<span class="k">def</span><span class="w"> </span><span class="nf">P_mediaplayeradd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
		<span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testMandatoryArguments</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;file&quot;</span><span class="p">])</span>
		<span class="k">if</span> <span class="n">res</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">res</span>
		<span class="k">return</span> <span class="n">mediaPlayerAdd</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;file&quot;</span><span class="p">))</span>

	<span class="k">def</span><span class="w"> </span><span class="nf">P_mediaplayerplay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
		<span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testMandatoryArguments</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;file&quot;</span><span class="p">])</span>
		<span class="k">if</span> <span class="n">res</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">res</span>

		<span class="n">root</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;root&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">mediaPlayerPlay</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;file&quot;</span><span class="p">),</span> <span class="n">root</span><span class="p">)</span>

	<span class="k">def</span><span class="w"> </span><span class="nf">P_mediaplayercmd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
		<span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testMandatoryArguments</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;command&quot;</span><span class="p">])</span>
		<span class="k">if</span> <span class="n">res</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">res</span>
		<span class="k">return</span> <span class="n">mediaPlayerCommand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;command&quot;</span><span class="p">))</span>

	<span class="k">def</span><span class="w"> </span><span class="nf">P_mediaplayercurrent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
		<span class="k">return</span> <span class="n">mediaPlayerCurrent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">)</span>

	<span class="k">def</span><span class="w"> </span><span class="nf">P_mediaplayerfindfile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
		<span class="n">path</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;path&quot;</span><span class="p">,</span> <span class="s2">&quot;/media/&quot;</span><span class="p">)</span>
		<span class="n">pattern</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;pattern&quot;</span><span class="p">,</span> <span class="s2">&quot;*.*&quot;</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">mediaPlayerFindFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">pattern</span><span class="p">)</span>

	<span class="k">def</span><span class="w"> </span><span class="nf">P_mediaplayerlist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
		<span class="n">path</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;path&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
		<span class="n">types</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;types&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">mediaPlayerList</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">types</span><span class="p">)</span>

	<span class="k">def</span><span class="w"> </span><span class="nf">P_mediaplayerremove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
		<span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testMandatoryArguments</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;file&quot;</span><span class="p">])</span>
		<span class="k">if</span> <span class="n">res</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">res</span>
		<span class="k">return</span> <span class="n">mediaPlayerRemove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;file&quot;</span><span class="p">))</span>

	<span class="k">def</span><span class="w"> </span><span class="nf">P_mediaplayerload</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
		<span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testMandatoryArguments</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">])</span>
		<span class="k">if</span> <span class="n">res</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">res</span>
		<span class="k">return</span> <span class="n">mediaPlayerLoad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;filename&quot;</span><span class="p">))</span>

	<span class="k">def</span><span class="w"> </span><span class="nf">P_mediaplayerwrite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
		<span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testMandatoryArguments</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">])</span>
		<span class="k">if</span> <span class="n">res</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">res</span>
		<span class="k">return</span> <span class="n">mediaPlayerSave</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;filename&quot;</span><span class="p">))</span>

<div class="viewcode-block" id="WebController.P_pluginlistread">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_pluginlistread">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_pluginlistread</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `pluginlistread` endpoint.</span>

<span class="sd">		.. seealso::</span>

<span class="sd">			https://github.com/oe-alliance/OpenWebif/wiki/OpenWebif-API-documentation#pluginlistread</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="n">reloadPlugins</span><span class="p">()</span></div>


<div class="viewcode-block" id="WebController.P_restarttwisted">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_restarttwisted">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_restarttwisted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `restarttwisted` endpoint.</span>

<span class="sd">		.. seealso::</span>

<span class="sd">			https://github.com/oe-alliance/OpenWebif/wiki/OpenWebif-API-documentation#restarttwisted</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="kn">from</span><span class="w"> </span><span class="nn">Plugins.Extensions.OpenWebif.httpserver</span><span class="w"> </span><span class="kn">import</span> <span class="n">HttpdRestart</span>
		<span class="n">HttpdRestart</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">)</span>
		<span class="k">return</span> <span class="s2">&quot;&quot;</span></div>


	<span class="k">def</span><span class="w"> </span><span class="nf">P_powertimer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">):</span>
			<span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testMandatoryArguments</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">,</span> <span class="s2">&quot;end&quot;</span><span class="p">,</span> <span class="s2">&quot;timertype&quot;</span><span class="p">,</span> <span class="s2">&quot;repeated&quot;</span><span class="p">,</span> <span class="s2">&quot;afterevent&quot;</span><span class="p">,</span> <span class="s2">&quot;disabled&quot;</span><span class="p">])</span>
			<span class="k">if</span> <span class="n">res</span><span class="p">:</span>
				<span class="k">return</span> <span class="n">res</span>
			<span class="k">return</span> <span class="n">setPowerTimer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">getPowerTimer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>

<div class="viewcode-block" id="WebController.P_sleeptimer">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_sleeptimer">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_sleeptimer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `sleeptimer` endpoint.</span>

<span class="sd">		.. seealso::</span>

<span class="sd">			https://github.com/oe-alliance/OpenWebif/wiki/OpenWebif-API-documentation#sleeptimer</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>

<span class="sd">		.. http:get:: /web/sleeptimer</span>

<span class="sd">			:query string cmd: command (*get* or *set*)</span>
<span class="sd">			:query int time: time in minutes (*0* -- *999*)</span>
<span class="sd">			:query string action: action (*standby* or *shutdown*)</span>
<span class="sd">			:query string enabled: enabled (*True* or *False*)</span>
<span class="sd">			:query string confirmed: confirmed (supported?)</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">cmd</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;cmd&quot;</span><span class="p">,</span> <span class="s2">&quot;get&quot;</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;get&quot;</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">getSleepTimer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">)</span>

		<span class="n">time</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">time</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">time</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
				<span class="k">if</span> <span class="n">time</span> <span class="o">&gt;</span> <span class="mi">999</span><span class="p">:</span>
					<span class="n">time</span> <span class="o">=</span> <span class="mi">999</span>
				<span class="k">elif</span> <span class="n">time</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
					<span class="n">time</span> <span class="o">=</span> <span class="mi">0</span>
			<span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
				<span class="k">pass</span>

		<span class="n">action</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;action&quot;</span><span class="p">,</span> <span class="s2">&quot;standby&quot;</span><span class="p">)</span>
		<span class="n">enabled</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;enabled&quot;</span><span class="p">)</span>
		<span class="n">enabled</span> <span class="o">=</span> <span class="n">enabled</span> <span class="ow">and</span> <span class="n">enabled</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span>

		<span class="n">ret</span> <span class="o">=</span> <span class="n">getSleepTimer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">)</span>

		<span class="k">if</span> <span class="n">cmd</span> <span class="o">!=</span> <span class="s2">&quot;set&quot;</span><span class="p">:</span>
			<span class="n">ret</span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;ERROR: Obligatory parameter &#39;cmd&#39; [get,set] has unspecified value &#39;</span><span class="si">{</span><span class="n">cmd</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
			<span class="k">return</span> <span class="n">ret</span>

		<span class="k">if</span> <span class="n">time</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">enabled</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>  <span class="c1"># it&#39;s used only if the timer is enabled</span>
			<span class="n">ret</span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ERROR: Obligatory parameter &#39;time&#39; [0-999] is missing&quot;</span>
			<span class="k">return</span> <span class="n">ret</span>

		<span class="k">if</span> <span class="n">enabled</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">ret</span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Obligatory parameter &#39;enabled&#39; [True,False] is missing&quot;</span>
			<span class="k">return</span> <span class="n">ret</span>

		<span class="k">return</span> <span class="n">setSleepTimer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">enabled</span><span class="p">)</span></div>


<div class="viewcode-block" id="WebController.P_external">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_external">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_external</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `external` endpoint.</span>

<span class="sd">		.. seealso::</span>

<span class="sd">			https://github.com/oe-alliance/OpenWebif/wiki/OpenWebif-API-documentation#external</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="kn">from</span><span class="w"> </span><span class="nn">Plugins.Extensions.WebInterface.WebChilds.Toplevel</span><span class="w"> </span><span class="kn">import</span> <span class="n">loaded_plugins</span>
			<span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">loaded_plugins</span><span class="p">:</span>
				<span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
			<span class="k">return</span> <span class="p">{</span>
				<span class="s2">&quot;plugins&quot;</span><span class="p">:</span> <span class="n">result</span>
			<span class="p">}</span>
		<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
			<span class="k">return</span> <span class="p">{</span>
				<span class="s2">&quot;plugins&quot;</span><span class="p">:</span> <span class="p">[]</span>
			<span class="p">}</span></div>


<div class="viewcode-block" id="WebController.P_settings">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_settings">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `settings` endpoint.</span>
<span class="sd">		Retrieve list of key/kalue pairs of device configuration.</span>

<span class="sd">		.. seealso::</span>

<span class="sd">			https://github.com/oe-alliance/OpenWebif/wiki/OpenWebif-API-documentation#settings</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="n">getSettings</span><span class="p">()</span></div>


<div class="viewcode-block" id="WebController.P_bouquets">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_bouquets">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_bouquets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `boquets` endpoint.</span>
<span class="sd">		Get list of tuples (bouquet reference, bouquet name) for available</span>
<span class="sd">		bouquets.</span>

<span class="sd">		.. note::</span>

<span class="sd">			Not available in *Enigma2 WebInterface API*.</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">stype</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;stype&quot;</span><span class="p">,</span> <span class="s2">&quot;tv&quot;</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">getBouquets</span><span class="p">(</span><span class="n">stype</span><span class="p">)</span></div>


	<span class="k">def</span><span class="w"> </span><span class="nf">P_epgmultigz</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">P_epgmulti</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

	<span class="k">def</span><span class="w"> </span><span class="nf">P_getsatellites</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
		<span class="n">stype</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;stype&quot;</span><span class="p">,</span> <span class="s2">&quot;tv&quot;</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">getSatellites</span><span class="p">(</span><span class="n">stype</span><span class="p">)</span>

<div class="viewcode-block" id="WebController.P_saveepg">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_saveepg">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_saveepg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `saveepg` endpoint.</span>

<span class="sd">		.. note::</span>

<span class="sd">			Not available in *Enigma2 WebInterface API*.</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">EPG</span><span class="p">()</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

		<span class="k">return</span> <span class="p">{</span>
			<span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
			<span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;EPG data saved&quot;</span><span class="p">,</span>
			<span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="n">comp_config</span><span class="o">.</span><span class="n">misc</span><span class="o">.</span><span class="n">epgcache_filename</span><span class="o">.</span><span class="n">value</span>
		<span class="p">}</span></div>


<div class="viewcode-block" id="WebController.P_loadepg">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_loadepg">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_loadepg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `loadepg` endpoint.</span>

<span class="sd">		.. note::</span>

<span class="sd">			Not available in *Enigma2 WebInterface API*.</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">EPG</span><span class="p">()</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>

		<span class="k">return</span> <span class="p">{</span>
			<span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
			<span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;EPG data loaded&quot;</span>
		<span class="p">}</span></div>


<div class="viewcode-block" id="WebController.P_getsubtitles">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_getsubtitles">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_getsubtitles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Request handler for the `getsubtitles` endpoint.</span>

<span class="sd">		.. note::</span>

<span class="sd">			Not available in *Enigma2 WebInterface API*.</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">service</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">nav</span><span class="o">.</span><span class="n">getCurrentService</span><span class="p">()</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;subtitlelist&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
		<span class="n">subtitle</span> <span class="o">=</span> <span class="n">service</span> <span class="ow">and</span> <span class="n">service</span><span class="o">.</span><span class="n">subtitle</span><span class="p">()</span>
		<span class="n">subtitlelist</span> <span class="o">=</span> <span class="n">subtitle</span> <span class="ow">and</span> <span class="n">subtitle</span><span class="o">.</span><span class="n">getSubtitleList</span><span class="p">()</span>
		<span class="k">if</span> <span class="n">subtitlelist</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">subtitlelist</span><span class="p">))):</span>
				<span class="n">ret</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
				<span class="n">subt</span> <span class="o">=</span> <span class="n">subtitlelist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
				<span class="n">ret</span><span class="p">[</span><span class="s2">&quot;subtitlelist&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
					<span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">subt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
					<span class="s2">&quot;pid&quot;</span><span class="p">:</span> <span class="n">subt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
					<span class="s2">&quot;page_nr&quot;</span><span class="p">:</span> <span class="n">subt</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
					<span class="s2">&quot;mag_nr&quot;</span><span class="p">:</span> <span class="n">subt</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
					<span class="s2">&quot;lang&quot;</span><span class="p">:</span> <span class="n">subt</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
				<span class="p">})</span>
		<span class="k">return</span> <span class="n">ret</span></div>


	<span class="k">def</span><span class="w"> </span><span class="nf">P_setmoviesort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
		<span class="n">nsort</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;nsort&quot;</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">nsort</span><span class="p">:</span>
			<span class="n">comp_config</span><span class="o">.</span><span class="n">OpenWebif</span><span class="o">.</span><span class="n">webcache</span><span class="o">.</span><span class="n">moviesort</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">nsort</span>
			<span class="n">comp_config</span><span class="o">.</span><span class="n">OpenWebif</span><span class="o">.</span><span class="n">webcache</span><span class="o">.</span><span class="n">moviesort</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
		<span class="k">return</span> <span class="p">{}</span>

	<span class="k">def</span><span class="w"> </span><span class="nf">P_css</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
		<span class="n">request</span><span class="o">.</span><span class="n">setHeader</span><span class="p">(</span><span class="s2">&quot;content-type&quot;</span><span class="p">,</span> <span class="s2">&quot;text/css&quot;</span><span class="p">)</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="p">{}</span>
		<span class="n">theme</span> <span class="o">=</span> <span class="s1">&#39;original&#39;</span>
		<span class="k">if</span> <span class="n">comp_config</span><span class="o">.</span><span class="n">OpenWebif</span><span class="o">.</span><span class="n">webcache</span><span class="o">.</span><span class="n">theme</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
			<span class="n">theme</span> <span class="o">=</span> <span class="n">comp_config</span><span class="o">.</span><span class="n">OpenWebif</span><span class="o">.</span><span class="n">webcache</span><span class="o">.</span><span class="n">theme</span><span class="o">.</span><span class="n">value</span>
		<span class="n">ret</span><span class="p">[</span><span class="s1">&#39;theme&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">theme</span>
		<span class="n">moviedb</span> <span class="o">=</span> <span class="n">comp_config</span><span class="o">.</span><span class="n">OpenWebif</span><span class="o">.</span><span class="n">webcache</span><span class="o">.</span><span class="n">moviedb</span><span class="o">.</span><span class="n">value</span> <span class="k">if</span> <span class="n">comp_config</span><span class="o">.</span><span class="n">OpenWebif</span><span class="o">.</span><span class="n">webcache</span><span class="o">.</span><span class="n">moviedb</span><span class="o">.</span><span class="n">value</span> <span class="k">else</span> <span class="s1">&#39;IMDb&#39;</span>
		<span class="n">ret</span><span class="p">[</span><span class="s1">&#39;moviedb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">moviedb</span>
		<span class="n">ret</span><span class="p">[</span><span class="s1">&#39;showchanneldetails&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">comp_config</span><span class="o">.</span><span class="n">OpenWebif</span><span class="o">.</span><span class="n">webcache</span><span class="o">.</span><span class="n">showchanneldetails</span><span class="o">.</span><span class="n">value</span>
		<span class="n">smallremote</span> <span class="o">=</span> <span class="n">comp_config</span><span class="o">.</span><span class="n">OpenWebif</span><span class="o">.</span><span class="n">webcache</span><span class="o">.</span><span class="n">smallremote</span><span class="o">.</span><span class="n">value</span> <span class="k">if</span> <span class="n">comp_config</span><span class="o">.</span><span class="n">OpenWebif</span><span class="o">.</span><span class="n">webcache</span><span class="o">.</span><span class="n">smallremote</span><span class="o">.</span><span class="n">value</span> <span class="k">else</span> <span class="s1">&#39;new&#39;</span>
		<span class="n">ret</span><span class="p">[</span><span class="s1">&#39;smallremote&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">smallremote</span>
		<span class="k">return</span> <span class="n">ret</span>

	<span class="k">def</span><span class="w"> </span><span class="nf">P_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>

		<span class="k">def</span><span class="w"> </span><span class="nf">RepresentsInt</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
				<span class="k">return</span> <span class="kc">True</span>
			<span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
				<span class="k">return</span> <span class="kc">False</span>

		<span class="n">setcs</span> <span class="o">=</span> <span class="n">getConfigsSections</span><span class="p">()</span>
		<span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">path</span> <span class="o">==</span> <span class="sa">b</span><span class="s1">&#39;/api/config&#39;</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">setcs</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">rp</span> <span class="o">=</span> <span class="n">toString</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
				<span class="n">sect</span> <span class="o">=</span> <span class="n">rp</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
				<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sect</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
					<span class="n">cfgs</span> <span class="o">=</span> <span class="n">getConfigs</span><span class="p">(</span><span class="n">sect</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
					<span class="n">resultcfgs</span> <span class="o">=</span> <span class="p">[]</span>
					<span class="k">for</span> <span class="n">cfg</span> <span class="ow">in</span> <span class="n">cfgs</span><span class="p">[</span><span class="s1">&#39;configs&#39;</span><span class="p">]:</span>
						<span class="n">_min</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
						<span class="n">kv</span> <span class="o">=</span> <span class="p">[]</span>
						<span class="n">data</span> <span class="o">=</span> <span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
						<span class="k">if</span> <span class="s1">&#39;choices&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
							<span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;choices&#39;</span><span class="p">]:</span>
								<span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">ch</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;tuple&#39;</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">ch</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">ch</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
									<span class="k">if</span> <span class="n">RepresentsInt</span><span class="p">(</span><span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
										<span class="n">kv</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
									<span class="k">else</span><span class="p">:</span>
										<span class="n">kv</span> <span class="o">=</span> <span class="p">[]</span>
										<span class="k">break</span>
								<span class="k">else</span><span class="p">:</span>
									<span class="n">kv</span> <span class="o">=</span> <span class="p">[]</span>
									<span class="k">break</span>

						<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">kv</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">kv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="p">(</span><span class="n">kv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
							<span class="n">_min</span> <span class="o">=</span> <span class="n">kv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
							<span class="n">_max</span> <span class="o">=</span> <span class="n">kv</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">kv</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>

						<span class="k">if</span> <span class="n">_min</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
							<span class="n">data</span><span class="p">[</span><span class="s1">&#39;min&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_min</span>
							<span class="n">data</span><span class="p">[</span><span class="s1">&#39;max&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_max</span>
							<span class="k">del</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;choices&#39;</span><span class="p">]</span>
							<span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
							<span class="n">resultcfgs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>
						<span class="k">else</span><span class="p">:</span>
							<span class="n">resultcfgs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>
					<span class="k">return</span> <span class="p">{</span><span class="s1">&#39;configs&#39;</span><span class="p">:</span> <span class="n">resultcfgs</span><span class="p">}</span>
			<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
				<span class="c1"># TODO show exception</span>
				<span class="k">pass</span>
		<span class="k">return</span> <span class="p">{}</span>

	<span class="k">def</span><span class="w"> </span><span class="nf">P_setwebconfig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
		<span class="n">args</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
		<span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
			<span class="n">sarg</span> <span class="o">=</span> <span class="n">toString</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">sarg</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;minmovielist&quot;</span><span class="p">,</span> <span class="s2">&quot;mintimerlist&quot;</span><span class="p">,</span> <span class="s2">&quot;minepglist&quot;</span><span class="p">,</span> <span class="s2">&quot;rcu_full_view&quot;</span><span class="p">,</span> <span class="s2">&quot;epgsearch_full&quot;</span><span class="p">,</span> <span class="s2">&quot;epgsearch_only_bq&quot;</span><span class="p">,</span> <span class="s2">&quot;nownext_columns&quot;</span><span class="p">,</span> <span class="s2">&quot;responsive_enabled&quot;</span><span class="p">,</span> <span class="s2">&quot;showpicons&quot;</span><span class="p">,</span> <span class="s2">&quot;showchanneldetails&quot;</span><span class="p">,</span> <span class="s2">&quot;showiptvchannelsinselection&quot;</span><span class="p">,</span> <span class="s2">&quot;screenshotchannelname&quot;</span><span class="p">,</span> <span class="s2">&quot;showallpackages&quot;</span><span class="p">,</span> <span class="s2">&quot;showepghistory&quot;</span><span class="p">,</span> <span class="s2">&quot;zapstream&quot;</span><span class="p">,</span> <span class="s2">&quot;screenshot_high_resolution&quot;</span><span class="p">,</span> <span class="s2">&quot;screenshot_refresh_auto&quot;</span><span class="p">):</span>
				<span class="n">val</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="n">arg</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="sa">b</span><span class="s2">&quot;true&quot;</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;1&quot;</span><span class="p">)</span>
				<span class="n">configitem</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">comp_config</span><span class="o">.</span><span class="n">OpenWebif</span><span class="o">.</span><span class="n">webcache</span><span class="p">,</span> <span class="n">sarg</span><span class="p">)</span>
				<span class="n">configitem</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">val</span>
				<span class="n">configitem</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
				<span class="k">return</span> <span class="p">{</span><span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
			<span class="k">elif</span> <span class="n">sarg</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;moviedb&quot;</span><span class="p">,</span> <span class="s2">&quot;smallremote&quot;</span><span class="p">,</span> <span class="s2">&quot;theme&quot;</span><span class="p">):</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="n">configitem</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">comp_config</span><span class="o">.</span><span class="n">OpenWebif</span><span class="o">.</span><span class="n">webcache</span><span class="p">,</span> <span class="n">sarg</span><span class="p">)</span>
					<span class="n">configitem</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">sarg</span><span class="p">)</span>
					<span class="n">configitem</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
				<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
					<span class="k">pass</span>
				<span class="k">return</span> <span class="p">{</span><span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
			<span class="k">elif</span> <span class="n">sarg</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;mepgmode&quot;</span><span class="p">,</span> <span class="s2">&quot;screenshot_refresh_time&quot;</span><span class="p">):</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="n">configitem</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">comp_config</span><span class="o">.</span><span class="n">OpenWebif</span><span class="o">.</span><span class="n">webcache</span><span class="p">,</span> <span class="n">sarg</span><span class="p">)</span>
					<span class="n">configitem</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="n">arg</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
					<span class="n">configitem</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
				<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
					<span class="k">pass</span>
				<span class="k">return</span> <span class="p">{</span><span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
		<span class="k">return</span> <span class="p">{</span><span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>

<div class="viewcode-block" id="WebController.P_getserviceref">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_getserviceref">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_getserviceref</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Get the serviceref from name.</span>


<span class="sd">		.. http:get:: /api/getserviceref</span>

<span class="sd">			:query string name: service name to find</span>
<span class="sd">			:query string searchinBouquetsOnly: must be &#39;true&#39;</span>
<span class="sd">			:query string bRef: define only one single bouquet where to find</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testMandatoryArguments</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
		<span class="k">if</span> <span class="n">res</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">res</span>
		<span class="n">name</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">)</span>
		<span class="n">bref</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;bRef&quot;</span><span class="p">)</span>
		<span class="n">searchinbouquetsonly</span> <span class="o">=</span> <span class="p">(</span><span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;searchinBouquetsOnly&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;true&#39;</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">getServiceRef</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">searchinbouquetsonly</span><span class="p">,</span> <span class="n">bref</span><span class="p">)</span></div>


<div class="viewcode-block" id="WebController.P_getpicon">
<a class="viewcode-back" href="../../controller.html#controllers.web.WebController.P_getpicon">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">P_getpicon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Get the picon from service.</span>

<span class="sd">		.. http:get:: /api/getpicon</span>

<span class="sd">			:query string sRef: service refrerence</span>
<span class="sd">			:query string path: path of the picons</span>
<span class="sd">			:query string json: result as json</span>

<span class="sd">		Args:</span>
<span class="sd">			request (twisted.web.server.Request): HTTP request object</span>
<span class="sd">		Returns:</span>
<span class="sd">			HTTP response with headers</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testMandatoryArguments</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;sRef&quot;</span><span class="p">])</span>
		<span class="k">if</span> <span class="n">res</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">res</span>
		<span class="n">path</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;path&quot;</span><span class="p">)</span>
		<span class="n">sref</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;sRef&quot;</span><span class="p">)</span>
		<span class="n">json</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;json&quot;</span><span class="p">)</span>
		<span class="n">pp</span> <span class="o">=</span> <span class="n">getPicon</span><span class="p">(</span><span class="n">sref</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">pp</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
				<span class="n">path</span> <span class="o">=</span> <span class="n">PICON_PATH</span>
			<span class="n">link</span> <span class="o">=</span> <span class="n">pp</span>
			<span class="n">pp</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/picon/&quot;</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">json</span> <span class="o">==</span> <span class="s1">&#39;true&#39;</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">pp</span><span class="p">:</span>
				<span class="k">return</span> <span class="p">{</span><span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="n">pp</span><span class="p">,</span> <span class="s2">&quot;link&quot;</span><span class="p">:</span> <span class="n">link</span><span class="p">}</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">return</span> <span class="p">{</span><span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">isImage</span> <span class="o">=</span> <span class="kc">True</span>
			<span class="k">return</span> <span class="n">pp</span></div>


	<span class="k">def</span><span class="w"> </span><span class="nf">P_setthememode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
		<span class="n">thememode</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;themeMode&quot;</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">thememode</span><span class="p">:</span>
			<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;save theme mode: </span><span class="si">{</span><span class="n">thememode</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
			<span class="n">comp_config</span><span class="o">.</span><span class="n">OpenWebif</span><span class="o">.</span><span class="n">responsive_themeMode</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">thememode</span>
			<span class="n">comp_config</span><span class="o">.</span><span class="n">OpenWebif</span><span class="o">.</span><span class="n">responsive_themeMode</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
		<span class="k">return</span> <span class="p">{}</span>

	<span class="k">def</span><span class="w"> </span><span class="nf">P_setskincolor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
		<span class="n">skincolor</span> <span class="o">=</span> <span class="n">getUrlArg</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;skincolor&quot;</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">skincolor</span><span class="p">:</span>
			<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;save color: </span><span class="si">{</span><span class="n">skincolor</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
			<span class="n">comp_config</span><span class="o">.</span><span class="n">OpenWebif</span><span class="o">.</span><span class="n">responsive_skinColor</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">skincolor</span>
			<span class="n">comp_config</span><span class="o">.</span><span class="n">OpenWebif</span><span class="o">.</span><span class="n">responsive_skinColor</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
		<span class="k">return</span> <span class="p">{}</span></div>



<div class="viewcode-block" id="ApiController">
<a class="viewcode-back" href="../../controller.html#controllers.web.ApiController">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ApiController</span><span class="p">(</span><span class="n">WebController</span><span class="p">):</span>
	<span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">session</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
		<span class="n">WebController</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">session</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>

	<span class="k">def</span><span class="w"> </span><span class="nf">prePageLoad</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
		<span class="n">request</span><span class="o">.</span><span class="n">setHeader</span><span class="p">(</span><span class="s2">&quot;Access-Control-Allow-Origin&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">isJson</span> <span class="o">=</span> <span class="kc">True</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023 jbleyel and others.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>